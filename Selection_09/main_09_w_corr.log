----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  main_09_w_corr
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_09/main_09_w_corr.log
  log type:  text
 opened on:  13 Jan 2018, 16:48:16

. 
. 
. 
. use "Earner_study.dta", clear

. 
. 
. ******************************************************************************************************************************
. *** Weekly wage, couple study, correlation
. ******************************************************************************************************************************
. 
. 
. 
. ******************************************************************************************************************************
. *** Initial operations: 
. ******************************************************************************************************************************
. 
. 
. drop rhourwage hourwage rhourwage_sp hourwage_sp

. 
. * For the correlation, I care also about the wage of the reference guy, then I drop the employed who don't repot wage.
. drop if paidhour == 0 & (empstat == 10 | empstat == 12)  
(215,310 observations deleted)

. 
. * Drop employed with zero wage
. drop if earnweek == 0 & ( empstat == 10 | empstat == 12 )
(3,098 observations deleted)

. drop if earnweek_sp == 0 & ( empstat_sp == 10 | empstat_sp == 12 )
(2,714 observations deleted)

. 
. 
. * Trim implausible weekly wage:
. drop if rearnweek > 2000 
(3 observations deleted)

. drop if rearnweek > 0 & rearnweek < 50  
(24,956 observations deleted)

. drop if rearnweek_sp>2000 
(0 observations deleted)

. drop if rearnweek_sp>0 & rearnweek_sp< 50 
(24,240 observations deleted)

. 
. 
. 
. 
. ** Use log wages
. gen log_wage = ln(rearnweek + 1), after(rearnweek)

. 
. gen log_wage_sp= ln(rearnweek_sp + 1), after(rearnweek_sp)

. 
. 
. 
. 
. ******************************************************************************************************************************
. *** Compute/graph the yearly avg. correlation of earnings of the couple -conditional on both working, and unconditional too.
. ******************************************************************************************************************************
. 
. sort year month         

. 
. *** General
. 
. ** Assign a number to each month 
. egen group = group(year month)

. order group, after(month)

. 
. 
. **  Unconditional 
. su group, meanonly

. gen cor_unc = .
(2,331,504 missing values generated)

. qui forvalues i = 1/`r(max)' {

. *
. 
. **  Conditional 
. su group, meanonly

. gen cor_con = .
(2,331,504 missing values generated)

. qui forvalues i = 1/`r(max)' {

. *
. 
. 
. **** Earnings correlation for age cluster
. 
. *** 18 --> 35
. 
. **  Unconditional 
. su group, meanonly

. gen cor_unc_18 = .
(2,331,504 missing values generated)

. qui forvalues i = 1/`r(max)' {

. *
. 
. **  Conditional 
. su group, meanonly

. gen cor_con_18 = .
(2,331,504 missing values generated)

. qui forvalues i = 1/`r(max)' {

. *
. 
. 
. *** 35 --> 55
. 
. **  Unconditional 
. su group, meanonly

. gen cor_unc_35 = .
(2,331,504 missing values generated)

. qui forvalues i = 1/`r(max)' {

. *
. 
. **  Conditional 
. su group, meanonly

. gen cor_con_35 = .
(2,331,504 missing values generated)

. qui forvalues i = 1/`r(max)' {

. *
. 
. 
. 
. *** 55 --> 65
. 
. **  Unconditional 
. su group, meanonly

. gen cor_unc_55 = .
(2,331,504 missing values generated)

. qui forvalues i = 1/`r(max)' {

. *
. 
. **  Conditional 
. su group, meanonly

. gen cor_con_55 = .
(2,331,504 missing values generated)

. qui forvalues i = 1/`r(max)' {

. *
. 
. 
. 
. 
. ** Collapse. ( Notice: it's important to graph after collapsing, otherwise it takes a while. )
. 
. collapse cor_unc cor_con cor_unc_18 cor_con_18 cor_unc_35 cor_con_35 cor_unc_55 cor_con_55, by ( year month )

. 
. ** Label
. label var cor_unc "Wages correlation"

. label var cor_con "Wages correlation"

. label var cor_unc_18 "Wages correlation"

. label var cor_con_18 "Wages correlation"

. label var cor_unc_35 "Wages correlation"

. label var cor_con_35 "Wages correlation"

. label var cor_unc_55 "Wages correlation"

. label var cor_con_55 "Wages correlation"

. 
. 
. ** Generate the time variable
. gen time=ym(year ,month), after(month)

. 
. *** Plots
. graph drop _all

. 
. ** Correlations
. 
. ** general
. tw line cor_unc time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(Corr_unc) title("Earnings correlation, uncoditional")

. graph export "$directory/Selection_10/Correlation/corr_unc.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Correlation/corr_unc.png written in PNG format)

. 
. tw line cor_con time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(Corr_con) title("Earnings correlation, conditional on both working")

. graph export "$directory/Selection_10/Correlation/corr_con.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Correlation/corr_con.png written in PNG format)

. 
. ** 18-->35
. tw line cor_unc_18 time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(Corr_unc_18) title("Earnings correlation, uncoditional, 18-35")

. graph export "$directory/Selection_10/Correlation/corr_unc_18.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Correlation/corr_unc_18.png written in PNG format)

. 
. tw line cor_con_18 time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(Corr_con_18) title("Earnings correlation, conditional on both working, 18-35")

. graph export "$directory/Selection_10/Correlation/corr_con_18.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Correlation/corr_con_18.png written in PNG format)

. 
. 
. ** 35-->65
. tw line cor_unc_35 time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(Corr_unc_35) title("Earnings correlation, uncoditional, 35-55")

. graph export "$directory/Selection_10/Correlation/corr_unc_35.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Correlation/corr_unc_35.png written in PNG format)

. 
. tw line cor_con_35 time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(Corr_con_35) title("Earnings correlation, conditional on both working, 35-55")

. graph export "$directory/Selection_10/Correlation/corr_con_35.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Correlation/corr_con_35.png written in PNG format)

. 
. 
. ** 55-->65
. tw line cor_unc_55 time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(Corr_unc_55) title("Earnings correlation, uncoditional, 55-65")

. graph export "$directory/Selection_10/Correlation/corr_unc_55.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Correlation/corr_unc_55.png written in PNG format)

. 
. tw line cor_con_55 time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(Corr_con_55) title("Earnings correlation, conditional on both working, 55-65")

. graph export "$directory/Selection_10/Correlation/corr_con_55.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Correlation/corr_con_55.png written in PNG format)

. 
. 
. cd "$directory/Selection_10/Correlation"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Correlation

. save "Corr.dta", replace
file Corr.dta saved

. 
. 
. cd "$directory/Selection_09"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_09

. log close main_09_w_corr
      name:  main_09_w_corr
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_09/main_09_w_corr.log
  log type:  text
 closed on:  13 Jan 2018, 16:58:04
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
