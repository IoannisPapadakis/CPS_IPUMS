----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  log_structure
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Structure/log_structure.log
  log type:  text
 opened on:  13 Jan 2018, 16:13:46

. 
. 
. ****************************************************************************************************************************** 
. *** This script, illustrates the procedure to get the final datasets from the raw starting one. It runs all the separate scripts and records the time.
. ****************************************************************************************************************************** 
. timer on 12

. 
. 
. cd "$directory/Selection_01"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_01

. timer on 1 

. do main_01.do

. cls 

. /*
> clear all
> program drop _all
> */
. set more off

. 
. global directory = "/Users/tommaso/Desktop/RAship_Javier/IPUMS"

. 
. cd "$directory/Selection_01"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_01

. 
. capture: log close main_01

. log using "main_01", name("main_01") text replace 
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  main_01
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_01/main_01.log
  log type:  text
 opened on:  13 Jan 2018, 16:13:46

. 
. 
. use "dataset_1.dta", clear

. 
. ******************************************************************************************************************************
. **** This script gets the raw data, analyzes the errors, and performs the trimming strategy. Note: the data are already sorted: cpsidp year month
. ******************************************************************************************************************************
. 
. 
. keep cpsid cpsidp year month age sex race marst ind1950 relate

. 
. 
. ******************************************************************************************************************************
. 
. *** check whether CPSIDP is correct:
. 
. ** check with age (one year tolerance)
. gen check_age_tol=0

. replace  check_age_tol=1 if cpsidp[_n]==cpsidp[_n-1]   &  age[_n] != age[_n-1]   &   age[_n] != age[_n-1]+1   &   age[_n] != age[_n-1]+2
(474,077 real changes made)

. 
. by cpsidp: egen check_1_age_tol = total(check_age_tol)

. 
. gen  check_2_age_tol=0

. replace check_2_age_tol=1 if check_1_age_tol != 0  // 6% 
(2,356,882 real changes made)

. 
. 
. 
. ** check with age (zero tolerance)
. gen check_age=0

. replace check_age=1 if cpsidp[_n]==cpsidp[_n-1]   &  age[_n] != age[_n-1]   &   age[_n] != age[_n-1]+1  
(527,042 real changes made)

. 
. by cpsidp: egen check_1_age = total(check_age)

. 
. gen check_2_age=0

. replace check_2_age=1 if check_1_age != 0  //  7%
(2,604,496 real changes made)

. 
. 
. ** check with sex:
. gen check_sex=0

. replace check_sex=1 if cpsidp[_n]==cpsidp[_n-1] & sex[_n] != sex[_n-1] 
(104,481 real changes made)

. 
. by cpsidp: egen check_1_sex = total(check_sex)

. 
. gen check_2_sex=0 //

. replace check_2_sex=1 if check_1_sex != 0  // 1%
(523,028 real changes made)

. 
. 
. ** check with race:
. gen check_race=0

. replace check_race=1 if cpsidp[_n]==cpsidp[_n-1] &  race[_n] != race[_n-1] 
(101,652 real changes made)

. 
. by cpsidp: egen check_1_race = total(check_race)

. 
. gen check_2_race=0

. replace check_2_race=1 if check_1_race != 0  // 1%
(551,504 real changes made)

. 
. 
. ** check with marital status (just for double check)
. gen check_mar=0

. replace check_mar=1 if cpsidp[_n]==cpsidp[_n-1] &  marst[_n] != marst[_n-1] 
(433,690 real changes made)

. 
. by cpsidp: egen check_1_mar = total(check_mar)

. 
. gen check_2_mar=0

. replace check_2_mar=1 if check_1_mar != 0 
(2,112,128 real changes made)

. 
. ** check with industry (just for double check)
. gen check_ind=0

. replace check_ind=1 if cpsidp[_n]==cpsidp[_n-1] &  ind1950[_n] != ind1950[_n-1] 
(2,690,271 real changes made)

. 
. by cpsidp: egen check_1_ind = total(check_ind)

. 
. gen check_2_ind=0

. replace check_2_ind=1 if check_1_ind != 0 
(10,216,324 real changes made)

. 
. 
. ** check with positon in th hh (just for double check)
. gen check_hh=0

. replace check_hh=1 if cpsidp[_n]==cpsidp[_n-1] &  relate[_n] != relate[_n-1] 
(175,986 real changes made)

. 
. by cpsidp: egen check_1_hh = total(check_hh)

. 
. gen check_2_hh=0

. replace check_2_hh=1 if check_1_hh != 0 
(945,521 real changes made)

. 
. 
. 
. ******************************************************************************************************************************
. 
. 
. *** Trimming strategy
. 
. 
. ** Keep only between 18 and 65
. keep if age >= 18 & age <= 65 
(14,179,223 observations deleted)

. 
. 
. ** I also drop the problematic months. Not possible to link observations. 
. drop if year == 1995 & ( month == 5 | month == 6 |month == 7 |month == 8 |month == 9 ) 
(423,498 observations deleted)

. drop if year == 1994 & month ==1   
(85,789 observations deleted)

. 
. 
. ** Drop errors
. drop if check_2_age_tol==1  &  check_2_race==1
(159,064 observations deleted)

. drop if check_2_age_tol==1  &  check_2_sex==1
(211,889 observations deleted)

. drop if check_2_age_tol==1  &  check_2_mar==1 
(254,403 observations deleted)

. drop if check_2_age_tol==1  &  check_2_hh==1 
(41,156 observations deleted)

. * so I keep 258,513 that jump more than two years of age but these other variables are consistent.
. 
. 
. drop if check_2_age==1 & check_2_race==1  // 9186 deleted 
(5,981 observations deleted)

. drop if check_2_age==1 & check_2_sex==1   // 10979 deleted
(7,413 observations deleted)

. drop if check_2_race==1 & check_2_sex==1  // 7173 deleted
(4,738 observations deleted)

. drop if check_2_age_tol==1 & check_2_ind==1 //482,382 deleted
(360,985 observations deleted)

. 
. drop check_age_tol check_1_age_tol check_2_age_tol check_age check_1_age check_2_age check_sex check_1_sex check_2_sex check_race check_1_race check_2_race check_mar check_1_mar check_2_mar check_ind check_1_ind 
> check_2_ind check_hh check_1_hh check_2_hh

. 
. ******************************************************************************************************************************
. 
. ** Merge with the raw dataset
. 
. merge 1:1 cpsid cpsidp year month using "Dataset_1"
(label mish_lbl already defined)
(label hhtenure_lbl already defined)
(label statefip_lbl already defined)
(label month_lbl already defined)
(label yngch_lbl already defined)
(label relate_lbl already defined)
(label age_lbl already defined)
(label sex_lbl already defined)
(label race_lbl already defined)
(label marst_lbl already defined)
(label educ_lbl already defined)
(label empstat_lbl already defined)
(label labforce_lbl already defined)
(label occ1950_lbl already defined)
(label ind1950_lbl already defined)
(label classwkr_lbl already defined)
(label uhrsworkt_lbl already defined)
(label uhrswork1_lbl already defined)
(label paidhour_lbl already defined)
(label lfproxy_lbl already defined)
(label eligorg_lbl already defined)
(label otpay_lbl already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                    15,734,139
        from master                         0  (_merge==1)
        from using                 15,734,139  (_merge==2)

    matched                        21,751,206  (_merge==3)
    -----------------------------------------

. drop if _merge !=3
(15,734,139 observations deleted)

. drop _merge

. 
. 
. ******************************************************************************************************************************
. 
. cd "$directory/Selection_02"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_02

. save "Dataset_2.dta", replace
file Dataset_2.dta saved

. 
. 
. cd "$directory/Selection_01"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_01

. log close main_01
      name:  main_01
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_01/main_01.log
  log type:  text
 closed on:  13 Jan 2018, 16:17:16
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

. 
end of do-file

. timer off 1

. 
. 
. cd "$directory/Selection_02"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_02

. timer on 2

. do main_02.do

. cls 

. 
. set more off

. 
. global directory = "/Users/tommaso/Desktop/RAship_Javier/IPUMS"

. 
. cd "$directory/Selection_02"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_02

. 
. capture: log close main_02

. log using "main_02", name("main_02") text replace 
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  main_02
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_02/main_02.log
  log type:  text
 opened on:  13 Jan 2018, 16:17:16

. 
. 
. use "Dataset_2.dta", clear

. 
. ******************************************************************************************************************************
. **** This script creates the preliminary variables I need for the analysis; then saves a NEW dataset: "Dataset_3"
. ******************************************************************************************************************************
. 
. 
. ** Create variable which indicates whether an individual has AT LEAST one child younger than 18; note: cannot assess the exact number of children younger than 18.
. gen child_18 = 0, before(relate)

. replace child = 1 if  yngch < 18
(7,956,016 real changes made)

. drop yngch

. 
. 
. **** Create a dummy for labor status transitions. Explanation in the STATA_book
. 
. * Create a dummy to identify workers in either: PA (federal, state, local), agricolture. (the category "armed force" will be handled directly from the variable "empstat")
. 
. gen agr_pa=0, before(cpsidp_sp)

. replace agr_pa=1 if ind1950==105 | ind1950==916 | ind1950==926 |  ind1950==936
(1,264,488 real changes made)

. 
. 
. **** Dummy for transition: yesterday --> today
. gen tran=0, before(cpsidp_sp)

. 
. ** U-->E
. replace tran=1 if cpsidp[_n]==cpsidp[_n-1] & mish[_n]==mish[_n-1]+1 & mish[_n] != 5 & ( empstat[_n]==10 | empstat[_n]==12 ) &  ( empstat[_n-1]==21 | empstat[_n-1]==22 ) & agr_pa[_n] != 1
(143,618 real changes made)

. 
. ** E-->U 
. replace tran=2 if cpsidp[_n]==cpsidp[_n-1] & mish[_n]==mish[_n-1]+1 & mish[_n] != 5 & ( empstat[_n-1]==10 | empstat[_n-1]==12 ) &  ( empstat[_n]==21 | empstat[_n]==22 ) & agr_pa[_n-1] != 1
(128,357 real changes made)

. 
. ** E-->E
. replace tran=3 if cpsidp[_n]==cpsidp[_n-1] & mish[_n]==mish[_n-1]+1 & mish[_n] != 5 & ( empstat[_n-1]==10 | empstat[_n-1]==12 ) &  ( empstat[_n]==10 | empstat[_n]==12 ) & agr_pa[_n-1] != 1  &  agr_pa[_n] != 1
(10,009,085 real changes made)

. 
. ** N-->E
. replace tran=4 if cpsidp[_n]==cpsidp[_n-1] & mish[_n]==mish[_n-1]+1 & mish[_n] != 5 &   labforce[_n-1]==01 &  ( empstat[_n]==10 | empstat[_n]==12 )  & agr_pa[_n] != 1
(204,903 real changes made)

. 
. ** E-->N
. replace tran=5 if cpsidp[_n]==cpsidp[_n-1] & mish[_n]==mish[_n-1]+1 & mish[_n] != 5 &   labforce[_n]==01 &  ( empstat[_n-1]==10 | empstat[_n-1]==12 )  & agr_pa[_n-1] != 1
(237,032 real changes made)

. 
. ** U-->N
. replace tran=6 if cpsidp[_n]==cpsidp[_n-1] & mish[_n]==mish[_n-1]+1 & mish[_n] != 5 &   labforce[_n]==01 &  ( empstat[_n-1]==21 | empstat[_n-1]==22 )
(130,544 real changes made)

. 
. ** N-->U
. replace tran=7 if cpsidp[_n]==cpsidp[_n-1] & mish[_n]==mish[_n-1]+1 & mish[_n] != 5 &   labforce[_n-1]==01 &  ( empstat[_n]==21 | empstat[_n]==22 )
(125,452 real changes made)

. 
. ** U-->U
. replace tran=8 if cpsidp[_n]==cpsidp[_n-1] & mish[_n]==mish[_n-1]+1 & mish[_n] != 5 & ( empstat[_n-1]==21 | empstat[_n-1]==22 ) &  ( empstat[_n]==21 | empstat[_n]==22 )
(338,600 real changes made)

. 
. ** N-->N
. replace tran=9 if cpsidp[_n]==cpsidp[_n-1] & mish[_n]==mish[_n-1]+1 & mish[_n] != 5 &   labforce[_n-1]==01 &  labforce[_n]==01
(3,105,222 real changes made)

. 
. 
. **** Dummy for transition: today --> tomorrow
. gen tran1 = tran[_n+1]
(1 missing value generated)

. order tran1,after(tran)

. 
. 
. ** Define the value labels
. label define flows 0 "." 1 "UE" 2 "EU" 3 "EE" 4 "NE" 5 "EN" 6 "UN" 7 "NU" 8 "UU" 9 "NN"

. label values tran flows

. label values tran1 flows

. 
. 
. 
. 
. **** Create dummy for occupational switching
. 
. * yesterday --> today
. gen switch=0, after(occ1950)

. replace switch=1 if cpsidp[_n]==cpsidp[_n-1] & mish[_n]==mish[_n-1]+1 & mish[_n] != 5 & occ1950[_n] != occ1950[_n-1] & occ1950[_n] != 999 & occ1950[_n-1] != 999
(612,458 real changes made)

. 
. * today --> tomorrow
. gen switch1 = switch[_n+1], after(switch)
(1 missing value generated)

. 
. 
. **** Create unemployment duration in previous period
. gen durunemp_pre = ., after(durunemp)
(21,751,206 missing values generated)

. replace durunemp_pre = durunemp[_n-1] if cpsidp[_n]==cpsidp[_n-1] & mish[_n]==mish[_n-1]+1 & mish[_n] != 5
(15,410,602 real changes made)

. 
. 
. 
. 
. **** Create broad category of industry and occupation
. 
. ** In ipums armed forces are coded together with unemployed for the occupation and NIU in industry, I change that:
. 
. replace occ1950 = 980 if empstat == 01
(114,875 real changes made)

. replace ind1950 = 980 if empstat == 01
(114,875 real changes made)

. 
. *** Occupation
. 
. gen occ1950_broad = ., after(occ1950)   
(21,751,206 missing values generated)

.         
. replace occ1950_broad = 1 if (occ1950 >= 000 & occ1950 <= 010)          /* Professional, Technical */
(383,802 real changes made)

. replace occ1950_broad = 2 if (occ1950 >= 012 & occ1950 <= 099)          /* Professors and instructors */
(3,700,895 real changes made)

. replace occ1950_broad = 3 if (occ1950 >= 100 & occ1950 <= 123)          /* Farmers */
(149,921 real changes made)

. replace occ1950_broad = 4 if (occ1950 >= 200 & occ1950 <= 290)          /* Managers, Officials, and Proprietors */
(2,389,276 real changes made)

. replace occ1950_broad = 5 if (occ1950 >= 300 & occ1950 <= 390)          /* Clerical and Kindred */
(2,748,111 real changes made)

. replace occ1950_broad = 6 if (occ1950 >= 400 & occ1950 <= 490)          /* Sales workers */
(993,528 real changes made)

. replace occ1950_broad = 7 if (occ1950 >= 500 & occ1950 <= 595)          /* Craftsmen */
(1,664,407 real changes made)

. replace occ1950_broad = 8 if (occ1950 >= 600 & occ1950 <= 690)          /* Operatives */
(1,643,429 real changes made)

. replace occ1950_broad = 9 if (occ1950 >= 700 & occ1950 <= 790)          /* Service Workers */
(2,370,739 real changes made)

. replace occ1950_broad = 10 if (occ1950 >= 810 & occ1950 <= 840)         /* Farm Laborers */
(98,702 real changes made)

. replace occ1950_broad = 11 if (occ1950 >= 910 & occ1950 <= 970)         /* Laborers */
(682,915 real changes made)

. replace occ1950_broad = 12 if occ1950 == 980    /* Armed Forces */
(114,875 real changes made)

. replace occ1950_broad = 997 if occ1950 == 997   /*Not reported/unknown*/
(0 real changes made)

. replace occ1950_broad = 999 if occ1950 == 999   /*NIU, no occupation*/
(4,810,606 real changes made)

.         
. 
. ** Define the value labels
. label define occ  1 "Professional, Technical" 2 "Professors and instructors" 3 "Farmers" 4 "Managers, Officials, and Proprietors" 5 "Clerical and Kindred" 6 "Sales workers" 7 "Craftsmen" 8 "Operatives" 9 "Service
>  Workers" 10 "Farm Laborers" 11 "Laborers" 12 "Armed Forces" 997 "Not reported/unknown" 999 "Unemployed- last worked over x years ag"            

. label values occ1950_broad occ

. 
. ** Create broad occupation in previous period
. gen occ1950_broad_pre = ., after(occ1950_broad)
(21,751,206 missing values generated)

. replace occ1950_broad_pre = occ1950_broad[_n-1] if cpsidp[_n]==cpsidp[_n-1] & mish[_n]==mish[_n-1]+1 & mish[_n] != 5
(15,410,602 real changes made)

. label values occ1950_broad_pre occ

.         
.         
. *** Industry
. 
. gen ind1950_broad = ., after(ind1950)
(21,751,206 missing values generated)

. 
. replace ind1950_broad = 0 if ind1950 == 000                       /*NIU*/
(4,811,298 real changes made)

. replace ind1950_broad = 1 if (ind1950 >= 105 & ind1950 <= 126)    /*AGRICULTURE, FORESTRY, AND FISHERIES*/
(462,228 real changes made)

. replace ind1950_broad = 2 if (ind1950 >= 206 & ind1950 <= 236)    /*MINING*/
(115,806 real changes made)

. replace ind1950_broad = 3 if ind1950 == 246                       /*CONSTRUCTION*/
(1,221,843 real changes made)

. replace ind1950_broad = 4 if (ind1950 >= 306 & ind1950 <= 499)    /*MANUFACTURING*/
(2,119,197 real changes made)

. replace ind1950_broad = 5 if (ind1950 >= 506 & ind1950 <= 598)    /*TRANSPORTATION, COMMUNICATIONS, AND OTHER PUBLIC UTILITIES*/
(885,014 real changes made)

. replace ind1950_broad = 6 if (ind1950 >= 606 & ind1950 <= 627)    /*WHOLESALE TRADE. Note: here Javier keeps separated the two subcategoires, and so do I. According to the criterion I follow for the categories, W
> holesale trade and Retail trade should go together*/ 
(508,495 real changes made)

. replace ind1950_broad = 7 if (ind1950 >= 636 & ind1950 <= 699)    /*RETAIL TRADE*/
(2,769,760 real changes made)

. replace ind1950_broad = 8 if (ind1950 >= 716 & ind1950 <= 746)    /*FINANCE, INSURANCE, AND REAL ESTATE*/
(1,089,329 real changes made)

. replace ind1950_broad = 9 if (ind1950 >= 806 & ind1950 <= 817)    /*BUSINESS AND REPAIR SERVICES*/
(1,281,867 real changes made)

. replace ind1950_broad = 10 if (ind1950 >= 826 & ind1950 <= 849)   /*PERSONAL SERVICES*/
(554,972 real changes made)

. replace ind1950_broad = 11 if (ind1950 >= 856 & ind1950 <= 859)   /*ENTERTAINMENT AND RECREATION SERVICES*/
(405,733 real changes made)

. replace ind1950_broad = 12 if (ind1950 >= 868 & ind1950 <= 899)   /*PROFESSIONAL AND RELATED SERVICES*/
(4,485,012 real changes made)

. replace ind1950_broad = 13 if (ind1950 >= 906 & ind1950 <= 936)   /*PUBLIC ADMINISTRATION*/
(925,777 real changes made)

. replace ind1950_broad = 14 if ind1950 == 980                      /*ARMED FORCES */
(114,875 real changes made)

. 
. 
. ** Define the value labels
. label define ind 0 "NIU" 1 "AGRICULTURE, FORESTRY, AND FISHERIES" 2 "MINING" 3 "CONSTRUCTION" 4 "MANUFACTURING" 5 "TRANSPORTATION, COMMUNICATIONS, AND OTHER PUBLIC UTILITIES" 6 "WHOLESALE TRADE" 7 "RETAIL TRADE" 
> 8 "FINANCE, INSURANCE, AND REAL ESTATE" 9 "BUSINESS AND REPAIR SERVICES" 10 "PERSONAL SERVICES" 11 "ENTERTAINMENT AND RECREATION SERVICES" 12 "PROFESSIONAL AND RELATED SERVICES" 13 "PUBLIC ADMINISTRATION" 14 "Arm
> ed Forces"            

. label values ind1950_broad ind

. 
. 
. ** Create broad industry in previous period
. gen ind1950_broad_pre = ., after(ind1950_broad)
(21,751,206 missing values generated)

. replace ind1950_broad_pre = ind1950_broad[_n-1] if cpsidp[_n]==cpsidp[_n-1] & mish[_n]==mish[_n-1]+1 & mish[_n] != 5
(15,410,602 real changes made)

. label values ind1950_broad_pre ind

. 
. 
. 
. **** Create broad category of race
. 
. gen race_broad =., after(race)
(21,751,206 missing values generated)

. 
. replace race_broad = 0 if race == 100
(18,072,250 real changes made)

. replace race_broad = 1 if race != 100 
(3,678,956 real changes made)

. 
. * Define the value labels
. label define race 0 "White" 1 "Non-white" 

. label values race_broad race

. 
. 
. 
. **** Create broad category of education; 
. 
. gen educ_broad =., after(educ)
(21,751,206 missing values generated)

. 
. replace educ_broad = 0 if educ >= 2 & educ <= 71
(2,561,160 real changes made)

. replace educ_broad = 1 if educ == 73
(6,770,061 real changes made)

. replace educ_broad = 2 if educ == 81
(4,380,985 real changes made)

. replace educ_broad = 3 if educ >= 91 & educ <= 111
(6,032,487 real changes made)

. replace educ_broad = 4 if educ >= 123 & educ <= 125
(2,006,513 real changes made)

. 
. * Define the value labels
. label define educ 0 "No highschool diploma" 1 "Highschool diploma" 2 "Some college but not degree" 3 "Associate or Bachelor degree" 4 "More than Associate or Bachelor degree" 

. label values educ_broad educ

. 
. 
. 
. 
. **** Create real wages: 
. 
. * Hour
. gen rhourwage = (hourwage / cpi) * 100, after(hourwage)

. label var rhourwage "reale hour wage"

. * Week
. gen rearnweek = (earnweek / cpi) * 100, after(earnweek)

. label var rearnweek "reale weekly wage"

. 
. * Drop cpi
. drop cpi

. 
. 
. 
. 
. 
. cd "$directory/Selection_03"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_03

. save "Dataset_3.dta", replace
file Dataset_3.dta saved

. 
. 
. cd "$directory/Selection_02"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_02

. log close main_02
      name:  main_02
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_02/main_02.log
  log type:  text
 closed on:  13 Jan 2018, 16:19:13
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

. 
. 
. 
. 
. 
end of do-file

. timer off 2

. 
. 
. cd "$directory/Selection_03"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_03

. timer on 3

. do main_03.do

. cls 

. 
. set more off

. 
. global directory = "/Users/tommaso/Desktop/RAship_Javier/IPUMS"

. 
. cd "$directory/Selection_03"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_03

. 
. capture: log close main_03

. log using "main_03", name("main_03") text replace 
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  main_03
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_03/main_03.log
  log type:  text
 opened on:  13 Jan 2018, 16:19:13

. 
. 
. use "Dataset_3.dta", clear

. 
. ******************************************************************************************************************************
. **** This script computes the general labor transition rates and the aggregate unemployment rate 
. ******************************************************************************************************************************
. 
. 
. ** I just need the following variables
. keep cpsidp year month sex empstat tran wtfinl agr_pa

. 
. ** I create a variable which contains the broad category of Employed, Unemployed, Not in the labor force. Careful! It refer to the previous observation in time! Hence is not consistent with empstat.
. gen empstat_broad = 0, before(tran)

. replace empstat_broad =1 if ( tran == 2 | tran == 3 | tran == 5 )
(10,374,474 real changes made)

. replace empstat_broad =2 if ( tran == 1 | tran == 6 | tran == 8 )
(612,762 real changes made)

. replace empstat_broad =3 if ( tran == 7 | tran == 9 | tran == 4 )
(3,435,577 real changes made)

. 
. * Define the value labels
. label define flows_1 1 "E" 2 "U" 3 "N" 

. label values empstat_broad flows_1

. 
. 
. ** Sort the data
. sort year month empstat_broad sex

. 
. ** Unemployment rate
. gen unEmp = 0

. replace unEmp = 1 if ( empstat == 21 | empstat == 22) & agr_pa[_n] != 1
(837,302 real changes made)

. by year month: egen unEmp_mr = total(unEmp)

. 
. gen Emp = 0

. replace Emp = 1 if ( empstat == 10 | empstat == 12) & agr_pa[_n] != 1
(14,618,350 real changes made)

. by year month: egen Emp_mr = total(Emp)

. 
. gen UnEmp_rate = unEmp_mr / ( unEmp_mr + Emp_mr )

. drop unEmp unEmp_mr Emp Emp_mr

. 
. ** I drop invalid transitions
. drop if tran==0  // (.)
(7,328,393 observations deleted)

. 
. 
. **** Compute the general transition rates       
. 
. ** For every combination of year momth and empstat_broad (which is defined with respect
. ** to the fisrt status of the transtion which refers to the previous observation)
. ** the script computes percentages of every type of transition. So for E there will 
. ** be the one of EE, EU, EN and will be zero for the other because by definition
. ** there is none. Given this, I then change the value from zero to missing.
. 
. *** General
. 
. ** E-->E
. generate EE_ind = tran == 3

. by year month empstat_broad: egen EE_mr = wtmean(100 * EE_ind), weight(wtfinl)

. 
. ** E-->U 
. generate EU_ind = tran == 2

. by year month empstat_broad: egen EU_mr = wtmean(100 * EU_ind), weight(wtfinl)

. 
. ** E-->N
. generate EN_ind = tran == 5

. by year month empstat_broad: egen EN_mr = wtmean(100 * EN_ind), weight(wtfinl)

. 
. ** U-->E
. generate UE_ind = tran == 1

. by year month empstat_broad: egen UE_mr = wtmean(100 * UE_ind), weight(wtfinl)

. 
. ** U-->U
. generate UU_ind = tran == 8

. by year month empstat_broad: egen UU_mr = wtmean(100 * UU_ind), weight(wtfinl)

. 
. ** U-->N
. generate UN_ind = tran == 6

. by year month empstat_broad: egen UN_mr = wtmean(100 * UN_ind), weight(wtfinl)

. 
. ** N-->E
. generate NE_ind = tran == 4

. by year month empstat_broad: egen NE_mr = wtmean(100 * NE_ind), weight(wtfinl)

. 
. ** N-->U
. generate NU_ind = tran == 7

. by year month empstat_broad: egen NU_mr = wtmean(100 * NU_ind), weight(wtfinl)

. 
. ** N-->N
. generate NN_ind = tran == 9

. by year month empstat_broad: egen NN_mr = mean(100 * NN_ind)

. 
. drop UE_ind EU_ind EE_ind NE_ind EN_ind UN_ind NU_ind UU_ind NN_ind

. 
. foreach x of varlist UE_mr EU_mr EE_mr NE_mr EN_mr UN_mr NU_mr UU_mr NN_mr  {  
  2.         replace `x'=. if `x'==0 
  3. }
(13,810,051 real changes made, 13,810,051 to missing)
(4,048,339 real changes made, 4,048,339 to missing)
(4,048,339 real changes made, 4,048,339 to missing)
(10,987,236 real changes made, 10,987,236 to missing)
(4,048,339 real changes made, 4,048,339 to missing)
(13,810,051 real changes made, 13,810,051 to missing)
(10,987,236 real changes made, 10,987,236 to missing)
(13,810,051 real changes made, 13,810,051 to missing)
(10,987,236 real changes made, 10,987,236 to missing)

. *
. 
. *** Conditional on gender
. 
. ** Females
. 
. ** E-->E
. generate EE_ind = tran == 3 if sex == 2
(6,835,122 missing values generated)

. by year month empstat_broad sex: egen EE_mr_f = wtmean(100 * EE_ind), weight(wtfinl)
(6835122 missing values generated)

. 
. ** E-->U 
. generate EU_ind = tran == 2 if sex == 2
(6,835,122 missing values generated)

. by year month empstat_broad sex: egen EU_mr_f = wtmean(100 * EU_ind), weight(wtfinl)
(6835122 missing values generated)

. 
. ** E-->N
. generate EN_ind = tran == 5 if sex == 2
(6,835,122 missing values generated)

. by year month empstat_broad sex: egen EN_mr_f = wtmean(100 * EN_ind), weight(wtfinl)
(6835122 missing values generated)

. 
. ** U-->E
. generate UE_ind = tran == 1 if sex == 2
(6,835,122 missing values generated)

. by year month empstat_broad sex: egen UE_mr_f = wtmean(100 * UE_ind), weight(wtfinl)
(6835122 missing values generated)

. 
. ** U-->U
. generate UU_ind = tran == 8 if sex == 2
(6,835,122 missing values generated)

. by year month empstat_broad sex: egen UU_mr_f = wtmean(100 * UU_ind), weight(wtfinl)
(6835122 missing values generated)

. 
. ** U-->N
. generate UN_ind = tran == 6 if sex == 2
(6,835,122 missing values generated)

. by year month empstat_broad sex: egen UN_mr_f = wtmean(100 * UN_ind), weight(wtfinl)
(6835122 missing values generated)

. 
. ** N-->E
. generate NE_ind = tran == 4 if sex == 2
(6,835,122 missing values generated)

. by year month empstat_broad sex: egen NE_mr_f = wtmean(100 * NE_ind), weight(wtfinl)
(6835122 missing values generated)

. 
. ** N-->U
. generate NU_ind = tran == 7 if sex == 2
(6,835,122 missing values generated)

. by year month empstat_broad sex: egen NU_mr_f = wtmean(100 * NU_ind), weight(wtfinl)
(6835122 missing values generated)

. 
. ** N-->N
. generate NN_ind = tran == 9 if sex == 2
(6,835,122 missing values generated)

. by year month empstat_broad sex: egen NN_mr_f = wtmean(100 * NN_ind), weight(wtfinl)
(6835122 missing values generated)

. 
. drop UE_ind EU_ind EE_ind NE_ind EN_ind UN_ind NU_ind UU_ind NN_ind

. 
. foreach x of varlist UE_mr_f EU_mr_f EE_mr_f NE_mr_f EN_mr_f UN_mr_f NU_mr_f UU_mr_f NN_mr_f  {  
  2.         replace `x'=. if `x'==0 
  3. }
(7,304,632 real changes made, 7,304,632 to missing)
(2,544,982 real changes made, 2,544,982 to missing)
(2,544,982 real changes made, 2,544,982 to missing)
(5,325,768 real changes made, 5,325,768 to missing)
(2,544,982 real changes made, 2,544,982 to missing)
(7,304,632 real changes made, 7,304,632 to missing)
(5,325,768 real changes made, 5,325,768 to missing)
(7,304,632 real changes made, 7,304,632 to missing)
(5,325,768 real changes made, 5,325,768 to missing)

. *
. 
. ** Males
. 
. ** E-->E
. generate EE_ind = tran == 3 if sex == 1
(7,587,691 missing values generated)

. by year month empstat_broad sex: egen EE_mr_m = wtmean(100 * EE_ind), weight(wtfinl)
(7587691 missing values generated)

. 
. ** E-->U 
. generate EU_ind = tran == 2 if sex == 1
(7,587,691 missing values generated)

. by year month empstat_broad sex: egen EU_mr_m = wtmean(100 * EU_ind), weight(wtfinl)
(7587691 missing values generated)

. 
. ** E-->N
. generate EN_ind = tran == 5 if sex == 1
(7,587,691 missing values generated)

. by year month empstat_broad sex: egen EN_mr_m = wtmean(100 * EN_ind), weight(wtfinl)
(7587691 missing values generated)

. 
. ** U-->E
. generate UE_ind = tran == 1 if sex == 1
(7,587,691 missing values generated)

. by year month empstat_broad sex: egen UE_mr_m = wtmean(100 * UE_ind), weight(wtfinl)
(7587691 missing values generated)

. 
. ** U-->U
. generate UU_ind = tran == 8 if sex == 1
(7,587,691 missing values generated)

. by year month empstat_broad sex: egen UU_mr_m = wtmean(100 * UU_ind), weight(wtfinl)
(7587691 missing values generated)

. 
. ** U-->N
. generate UN_ind = tran == 6 if sex == 1
(7,587,691 missing values generated)

. by year month empstat_broad sex: egen UN_mr_m = wtmean(100 * UN_ind), weight(wtfinl)
(7587691 missing values generated)

. 
. ** N-->E
. generate NE_ind = tran == 4 if sex == 1
(7,587,691 missing values generated)

. by year month empstat_broad sex: egen NE_mr_m = wtmean(100 * NE_ind), weight(wtfinl)
(7587691 missing values generated)

. 
. ** N-->U
. generate NU_ind = tran == 7 if sex == 1
(7,587,691 missing values generated)

. by year month empstat_broad sex: egen NU_mr_m = wtmean(100 * NU_ind), weight(wtfinl)
(7587691 missing values generated)

. 
. ** N-->N
. generate NN_ind = tran == 9 if sex == 1
(7,587,691 missing values generated)

. by year month empstat_broad sex: egen NN_mr_m = wtmean(100 * NN_ind), weight(wtfinl)
(7587691 missing values generated)

. 
. drop UE_ind EU_ind EE_ind NE_ind EN_ind UN_ind NU_ind UU_ind NN_ind

. 
. foreach x of varlist UE_mr_m EU_mr_m EE_mr_m NE_mr_m EN_mr_m UN_mr_m NU_mr_m UU_mr_m NN_mr_m  {  
  2.         replace `x'=. if `x'==0 
  3. }
(6,505,419 real changes made, 6,505,419 to missing)
(1,503,357 real changes made, 1,503,357 to missing)
(1,503,357 real changes made, 1,503,357 to missing)
(5,661,468 real changes made, 5,661,468 to missing)
(1,503,357 real changes made, 1,503,357 to missing)
(6,505,419 real changes made, 6,505,419 to missing)
(5,661,468 real changes made, 5,661,468 to missing)
(6,505,419 real changes made, 6,505,419 to missing)
(5,661,468 real changes made, 5,661,468 to missing)

. *
. 
. save "until_here", replace
file until_here.dta saved

. 
. 
. ** Collapse the dataset: one obs for each month year combination: the percentage of t
. 
. collapse UnEmp_rate EE_mr EU_mr EN_mr UE_mr UU_mr UN_mr NE_mr NU_mr NN_mr EE_mr_f EU_mr_f EN_mr_f UE_mr_f UU_mr_f UN_mr_f NE_mr_f NU_mr_f NN_mr_f EE_mr_m EU_mr_m EN_mr_m UE_mr_m UU_mr_m UN_mr_m NE_mr_m NU_mr_m NN
> _mr_m, by( year month empstat_broad sex )

. 
. 
. *** Graphs
. 
. ** generate the time variable
. gen time=ym(year ,month), after(month)

. 
. ** lable
. 
. label var EE_mr_f "female"

. label var EU_mr_f "female"

. label var EN_mr_f "female"

. label var UE_mr_f "female"

. label var UU_mr_f "female"

. label var UN_mr_f "female"

. label var NE_mr_f "female"

. label var NU_mr_f "female"

. label var NN_mr_f "female"

. 
. label var EE_mr_m "male"

. label var EU_mr_m "male"

. label var EN_mr_m "male"

. label var UE_mr_m "male"

. label var UU_mr_m "male"

. label var UN_mr_m "male"

. label var NE_mr_m "male"

. label var NU_mr_m "male"

. label var NN_mr_m "male"

. 
. graph drop _all

. 
. ** general
. 
. tw line EE_mr time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(EE) title("EE")

. graph export "$directory/Selection_04/General/EE.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_04/General/EE.png written in PNG format)

. 
. tw line EU_mr time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(EU) title("EU")

. graph export "$directory/Selection_04/General/EU.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_04/General/EU.png written in PNG format)

. 
. tw line EN_mr time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(EN) title("EN")

. graph export "$directory/Selection_04/General/EN.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_04/General/EN.png written in PNG format)

. 
. tw line UE_mr time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(UE) title("UE")

. graph export "$directory/Selection_04/General/UE.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_04/General/UE.png written in PNG format)

. 
. tw line UU_mr time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(UU) title("UU")

. graph export "$directory/Selection_04/General/UU.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_04/General/UU.png written in PNG format)

. 
. tw line UN_mr time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(UN) title("UN")

. graph export "$directory/Selection_04/General/UN.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_04/General/UN.png written in PNG format)

. 
. tw line NE_mr time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(NE) title("NE")

. graph export "$directory/Selection_04/General/NE.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_04/General/NE.png written in PNG format)

. 
. tw line NU_mr time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(NU) title("NU")

. graph export "$directory/Selection_04/General/NU.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_04/General/NU.png written in PNG format)

. 
. tw line NN_mr time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(NN) title("NN")

. graph export "$directory/Selection_04/General/NN.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_04/General/NN.png written in PNG format)

. 
. 
. 
. ** Female Male
. 
. tw line EE_mr_m EE_mr_f time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(EE_gender) title("EE") lpattern(solid longdash)

. graph export "$directory/Selection_04/Gender/EE_gender.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_04/Gender/EE_gender.png written in PNG format)

. 
. tw line EU_mr_m EU_mr_f time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(EU_gender) title("EU") lpattern(solid longdash)

. graph export "$directory/Selection_04/Gender/EU_gender.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_04/Gender/EU_gender.png written in PNG format)

. 
. tw line EN_mr_m EN_mr_f time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(EN_gender) title("EN") lpattern(solid longdash)

. graph export "$directory/Selection_04/Gender/EN_gender.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_04/Gender/EN_gender.png written in PNG format)

. 
. tw line UE_mr_m UE_mr_f time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(UE_gender) title("UE") lpattern(solid longdash)

. graph export "$directory/Selection_04/Gender/UE_gender.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_04/Gender/UE_gender.png written in PNG format)

. 
. tw line UU_mr_m UU_mr_f time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(UU_gender) title("UU") lpattern(solid longdash)

. graph export "$directory/Selection_04/Gender/UU_gender.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_04/Gender/UU_gender.png written in PNG format)

. 
. tw line UN_mr_m UN_mr_f time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(UN_gender) title("UN") lpattern(solid longdash)

. graph export "$directory/Selection_04/Gender/UN_gender.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_04/Gender/UN_gender.png written in PNG format)

. 
. tw line NE_mr_m NE_mr_f time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(NE_gender) title("NE") lpattern(solid longdash)

. graph export "$directory/Selection_04/Gender/NE_gender.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_04/Gender/NE_gender.png written in PNG format)

. 
. tw line NU_mr_m NU_mr_f time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(NU_gender) title("NU") lpattern(solid longdash)

. graph export "$directory/Selection_04/Gender/NU_gender.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_04/Gender/NU_gender.png written in PNG format)

. 
. tw line NN_mr_m NN_mr_f time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(NN_gender) title("NN") lpattern(solid longdash)

. graph export "$directory/Selection_04/Gender/NN_gender.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_04/Gender/NN_gender.png written in PNG format)

. 
. 
. 
. ** Manipulates the final aggregate dataset
. drop sex time empstat_broad

. collapse UnEmp_rate EE_mr EU_mr EN_mr UE_mr UU_mr UN_mr NE_mr NU_mr NN_mr EE_mr_f EU_mr_f EN_mr_f UE_mr_f UU_mr_f UN_mr_f NE_mr_f NU_mr_f NN_mr_f EE_mr_m EU_mr_m EN_mr_m UE_mr_m UU_mr_m UN_mr_m NE_mr_m NU_mr_m NN
> _mr_m, by ( year month )

. label var UnEmp_rate "Unemployment rate"

. label var EE_mr_f "female"

. label var EU_mr_f "female"

. label var EN_mr_f "female"

. label var UE_mr_f "female"

. label var UU_mr_f "female"

. label var UN_mr_f "female"

. label var NE_mr_f "female"

. label var NU_mr_f "female"

. label var NN_mr_f "female"

. 
. label var EE_mr_m "male"

. label var EU_mr_m "male"

. label var EN_mr_m "male"

. label var UE_mr_m "male"

. label var UU_mr_m "male"

. label var UN_mr_m "male"

. label var NE_mr_m "male"

. label var NU_mr_m "male"

. label var NN_mr_m "male"

. 
. 
. cd "$directory/Selection_04"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_04

. 
. save "Dataset_4.dta", replace
file Dataset_4.dta saved

. 
. cd "$directory/Selection_03"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_03

. 
. log close main_03
      name:  main_03
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_03/main_03.log
  log type:  text
 closed on:  13 Jan 2018, 16:25:23
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

. 
end of do-file

. timer off 3

. 
. timer on 4

. do main_04.do

. cls 

. 
. set more off

. 
. global directory = "/Users/tommaso/Desktop/RAship_Javier/IPUMS"

. 
. cd "$directory/Selection_03"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_03

. 
. capture: log close main_04

. log using "main_04", name("main_04") text replace 
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  main_04
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_03/main_04.log
  log type:  text
 opened on:  13 Jan 2018, 16:25:23

. 
. 
. 
. use "Dataset_3.dta", clear

. 
. ******************************************************************************************************************************
. **** Build partner connection and creates the couples's labor characteristic variable
. ******************************************************************************************************************************
. 
. 
. ** I keep only the married couples who live together
. keep if marst==1
(9,366,218 observations deleted)

. 
. ** Among married individuals, some observations don't report the partner's id. I drop them
. drop if cpsidp_sp==.  // 218 deleted
(229 observations deleted)

. 
. 
. sort cpsidp_sp

. order cpsid cpsidp_sp cpsidp

. 
. 
. foreach x of var * {   // rename all of the variables as the "spouse variable"
  2.         rename `x' `x'_sp 
  3. }

. *
. 
. 
. rename cpsid_sp cpsid

. rename cpsidp_sp cpsidp

. rename cpsidp_sp_sp cpsidp_sp

. rename year_sp year  

. rename month_sp month  // take it back to the original after the loop

. 
. 
. rename cpsidp_sp cpsidp_temp 

. rename cpsidp cpsidp_sp_temp

. 
. rename cpsidp_temp cpsidp

. rename cpsidp_sp_temp cpsidp_sp //  careful: I do this to match the partners with the references: but while the original cpsidp is present and non-missing for every observation, cpsidp_sp is missing for many

. 
. 
. 
. save "Partners_tmp.dta", replace
(note: file Partners_tmp.dta not found)
file Partners_tmp.dta saved

. use "Dataset_3.dta", clear

. 
. merge 1:1 cpsidp year month using "partners_tmp.dta"
(label educ already defined)
(label race already defined)
(label ind already defined)
(label occ already defined)
(label flows already defined)
(label mish_lbl already defined)
(label hhtenure_lbl already defined)
(label statefip_lbl already defined)
(label month_lbl already defined)
(label relate_lbl already defined)
(label age_lbl already defined)
(label sex_lbl already defined)
(label race_lbl already defined)
(label marst_lbl already defined)
(label educ_lbl already defined)
(label empstat_lbl already defined)
(label labforce_lbl already defined)
(label occ1950_lbl already defined)
(label ind1950_lbl already defined)
(label classwkr_lbl already defined)
(label uhrsworkt_lbl already defined)
(label uhrswork1_lbl already defined)
(label paidhour_lbl already defined)
(label lfproxy_lbl already defined)
(label eligorg_lbl already defined)
(label otpay_lbl already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                    10,585,457
        from master                 9,975,952  (_merge==1)
        from using                    609,505  (_merge==2)

    matched                        11,775,254  (_merge==3)
    -----------------------------------------

. 
. drop if _merge==2  // Two things can happen: we can have that a person is not married and this goes to master only. But we can also have that the person is married, we have the identifier but for that specific mo
> nth and year that person (the partner) is missing and is therefore not present as cpsidp in the dataset_03    
(609,505 observations deleted)

. drop _merge

. 
. erase "Partners_tmp.dta"

. save "Partners_tmp.dta", replace
(note: file Partners_tmp.dta not found)
file Partners_tmp.dta saved

. 
. 
. 
. 
. ******************************************************************************************************************************
. **** Create the couples's labor characteristic variable
. ******************************************************************************************************************************
. 
. **** I keep only the variables I need for this computation: I WANT TO HAVE THE FIRST LETTER TO BE RELATIVE TO THE MALE THEREFORE I HAVE TO DO ALL THIS MERGE
. keep cpsid cpsidp year month sex child_18 relate marst empstat labforce tran cpsidp_sp sex_sp marst_sp empstat_sp labforce_sp mish

. 
. ** Drop if partner's employment status is missing
. drop if empstat_sp==.     // 605,696 deleted
(9,975,952 observations deleted)

. 
. ** I now need to define the observation related to the couple. That is, I have to be careful not to count one couple twice, once for each partner, I can just get rid of the female.
. drop if sex== 2
(5,887,627 observations deleted)

. 
. 
. *** Create a new variable wich indicates the labor market caracteristic of the couple, according to the definition of Nezih.
. gen couple_labor=0

. 
. ** UE ( first letter: male; second letter: spouse )
. replace couple_labor=1 if ( empstat==21 | empstat==22 ) & ( empstat_sp==10 | empstat_sp==12 | empstat_sp==01 )
(108,695 real changes made)

. 
. ** EU
. replace couple_labor=2 if ( empstat==10 | empstat==12 | empstat==01 ) & ( empstat_sp==21 | empstat_sp==22 )
(114,904 real changes made)

. 
. ** EE
. replace couple_labor=3 if ( empstat==10 | empstat==12 | empstat==01 ) &  ( empstat_sp==10 | empstat_sp==12 | empstat_sp==01 ) 
(3,641,374 real changes made)

. 
. ** NE
. replace couple_labor=4 if labforce==01 &  ( empstat_sp==10 | empstat_sp==12 | empstat_sp==01 ) 
(323,495 real changes made)

. 
. ** EN
. replace couple_labor=5 if ( empstat==10 | empstat==12 | empstat==01 ) & labforce_sp==01 
(1,313,658 real changes made)

. 
. ** UN
. replace couple_labor=6 if ( empstat==21 | empstat==22 ) & labforce_sp==01 
(42,709 real changes made)

. 
. ** NU
. replace couple_labor=7 if labforce==01 & ( empstat_sp==21 | empstat_sp==22 )
(14,328 real changes made)

. 
. ** UU
. replace couple_labor=8 if ( empstat==21 | empstat==22 ) &  ( empstat_sp==21 | empstat_sp==22 )
(15,220 real changes made)

. 
. ** NN
. replace couple_labor=9 if labforce==01 &  labforce_sp==01
(313,244 real changes made)

. 
. ** Define the value labels
. label define link 1 "UE" 2 "EU" 3 "EE" 4 "NE" 5 "EN" 6 "UN" 7 "NU" 8 "UU" 9 "NN"

. label values couple_labor link

. 
. 
. save "Partners_tmp_2.dta", replace
(note: file Partners_tmp_2.dta not found)
file Partners_tmp_2.dta saved

. use "Partners_tmp.dta", clear

. 
. 
. merge 1:1 cpsidp year month using "Partners_tmp_2.dta"
(label labforce_lbl already defined)
(label empstat_lbl already defined)
(label marst_lbl already defined)
(label sex_lbl already defined)
(label relate_lbl already defined)
(label month_lbl already defined)
(label mish_lbl already defined)
(label flows already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                    15,863,579
        from master                15,863,579  (_merge==1)
        from using                          0  (_merge==2)

    matched                         5,887,627  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. 
. erase "Partners_tmp_2.dta"

. 
. 
. 
. 
. 
. cd "$directory/Selection_05"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_05

. 
. save "Partners.dta", replace
file Partners.dta saved

. 
. 
. 
. cd "$directory/Selection_03"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_03

. 
. erase "Partners_tmp.dta"

. 
. log close main_04
      name:  main_04
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_03/main_04.log
  log type:  text
 closed on:  13 Jan 2018, 16:37:49
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

. 
. 
. 
. 
end of do-file

. timer off 4

. 
. 
. cd "$directory/Selection_05"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_05

. timer on 5

. do main_05.do

. cls 

. 
. set more off

. 
. global directory = "/Users/tommaso/Desktop/RAship_Javier/IPUMS"

. 
. 
. cd "$directory/Selection_05"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_05

. 
. capture: log close main_05

. log using "main_05", name("main_05") text replace 
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  main_05
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_05/main_05.log
  log type:  text
 opened on:  13 Jan 2018, 16:37:49

. 
. use "Partners.dta", clear

. 
. ******************************************************************************************************************************
. **** This script computes the monthly stocks for couples'labor characteristic
. ******************************************************************************************************************************
. 
. 
. ** I keep only the variables I need for this computation
. keep cpsid cpsidp year month sex  relate marst empstat_sp couple_labor hwtfinl

. 
. 
. ** I keep only the married couples who live together
. keep if marst==1
(9,366,218 observations deleted)

. 
. 
. ** Drop if partner's emplyment status is missing
. drop if empstat_sp==.     // 605,696 deleted
(609,734 observations deleted)

. 
. 
. ** I now need to define the observation related to the couple. That is, I have to be careful not to count one couple twice, once for each partner, get rid of females.
. drop if sex == 2
(5,887,627 observations deleted)

. 
. 
. 
. *** I compute the monthly rate for each kind of couples as a percentage of the couples in the sample
.         
. sort year month         

. 
.         
. ** UE
. generate UE_ind = couple_labor == 1

. by year month: egen UE_mr = wtmean(100 * UE_ind), weight(hwtfinl)

. 
. ** EU 
. generate EU_ind = couple_labor == 2

. by year month: egen EU_mr = wtmean(100 * EU_ind), weight(hwtfinl)

. 
. ** EE
. generate EE_ind = couple_labor == 3

. by year month: egen EE_mr = wtmean(100 * EE_ind), weight(hwtfinl)

. 
. ** NE
. generate NE_ind = couple_labor == 4

. by year month: egen NE_mr = wtmean(100 * NE_ind), weight(hwtfinl)

. 
. ** EN
. generate EN_ind = couple_labor == 5

. by year month: egen EN_mr = wtmean(100 * EN_ind), weight(hwtfinl)

. 
. ** UN
. generate UN_ind = couple_labor == 6

. by year month: egen UN_mr = wtmean(100 * UN_ind), weight(hwtfinl)

. 
. ** NU
. generate NU_ind = couple_labor == 7

. by year month: egen NU_mr = wtmean(100 * NU_ind), weight(hwtfinl)

. 
. ** UU
. generate UU_ind = couple_labor == 8

. by year month: egen UU_mr = wtmean(100 * UU_ind), weight(hwtfinl)

. 
. ** NN
. generate NN_ind = couple_labor == 9

. by year month: egen NN_mr = wtmean(100 * NN_ind), weight(hwtfinl)

. 
. 
. drop UE_ind EU_ind EE_ind NE_ind EN_ind UN_ind NU_ind UU_ind NN_ind

. 
. keep cpsidp year month UE_mr EU_mr EE_mr NE_mr EN_mr UN_mr NU_mr UU_mr NN_mr 

. 
. collapse UE_mr EU_mr EE_mr NE_mr EN_mr UN_mr NU_mr UU_mr NN_mr, by(year month)

. 
. 
. 
. *** Graphs
. 
. ** generate the time variable
. gen time=ym(year ,month), after(month)

. 
. 
. graph drop _all

. 
. ** General
. 
. tw line UE_mr time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(UE) title("UE")

. graph export "$directory/Selection_06/ue.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_06/ue.png written in PNG format)

. 
. tw line EU_mr time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(EU) title("EU")

. graph export "$directory/Selection_06/eu.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_06/eu.png written in PNG format)

. 
. tw line EE_mr time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(EE) title("EE")

. graph export "$directory/Selection_06/ee.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_06/ee.png written in PNG format)

. 
. tw line NE_mr time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(NE) title("NE")

. graph export "$directory/Selection_06/ne.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_06/ne.png written in PNG format)

. 
. tw line EN_mr time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(EN) title("EN")

. graph export "$directory/Selection_06/en.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_06/en.png written in PNG format)

. 
. tw line UN_mr time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(UN) title("UN")

. graph export "$directory/Selection_06/un.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_06/un.png written in PNG format)

. 
. tw line NU_mr time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(NU) title("NU")

. graph export "$directory/Selection_06/nu.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_06/nu.png written in PNG format)

. 
. tw line UU_mr time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(UU) title("UU")

. graph export "$directory/Selection_06/uu.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_06/uu.png written in PNG format)

. 
. tw line NN_mr time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(NN) title("NN")

. graph export "$directory/Selection_06/nn.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_06/nn.png written in PNG format)

. 
. 
. *** Manipulate the final dataset
. drop time

. order year month EE_mr EU_mr EN_mr UE_mr UU_mr UN_mr NE_mr NU_mr NN_mr

. 
. ** Change the name of the variable to distinguish them from the general transition rates
. foreach x of varlist UE_mr EU_mr EE_mr NE_mr EN_mr UN_mr NU_mr UU_mr NN_mr  {  
  2.    rename  `x' `x'_couple 
  3.    }

. 
. *
. 
. 
. foreach x of varlist UE_mr EU_mr EE_mr NE_mr EN_mr UN_mr NU_mr UU_mr NN_mr  {  
  2.    label var `x' "Couple characteristic" 
  3.    }

. 
. *
. 
. cd "$directory/Selection_06"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_06

. 
. save "Cond_tran.dta", replace
file Cond_tran.dta saved

. 
. 
. cd "$directory/Selection_05"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_05

. 
. log close main_05
      name:  main_05
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_05/main_05.log
  log type:  text
 closed on:  13 Jan 2018, 16:40:08
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

. 
end of do-file

. timer off 5

. 
. timer on 6

. do main_06.do

. cls 

. 
. set more off

. 
. global directory = "/Users/tommaso/Desktop/RAship_Javier/IPUMS"

. 
. cd "$directory/Selection_05"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_05

. 
. capture: log close main_06

. log using "main_06", name("main_06") text replace 
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  main_06
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_05/main_06.log
  log type:  text
 opened on:  13 Jan 2018, 16:40:08

. 
. use "Partners.dta", clear

. 
. ******************************************************************************************************************************
. **** This script compute the individual transtion rates conditional on the partner status. 
. ******************************************************************************************************************************
. 
. 
. ** Keep only the variable I need for this computation
. keep cpsid cpsidp year month sex empstat labforce tran marst cpsidp_sp empstat_sp labforce_sp wtfinl

. 
. 
. ** I keep only the married couples who live together
. keep if marst==1
(9,366,218 observations deleted)

. 
. 
. ** Drop if partner's emplyment status is missing
. drop if empstat_sp==.     // 605,696 deleted
(609,734 observations deleted)

. 
. 
. ** I drop invalid transitions
. drop if tran==0  // (.)
(3,929,722 observations deleted)

. 
. 
. ** I create a variable which contains the broad category of Employed, Unemployed, Not in the labor force. Careful! It refer to the previous observation in time! Hence is not consistent with empstat.
. gen empstat_broad = 0, before(tran)

. replace empstat_broad =1 if ( tran == 2 | tran == 3 | tran == 5 )
(5,983,811 real changes made)

. replace empstat_broad =2 if ( tran == 1 | tran == 6 | tran == 8 )
(219,761 real changes made)

. replace empstat_broad =3 if ( tran == 7 | tran == 9 | tran == 4 )
(1,641,960 real changes made)

. 
. * Define the value labels
. label define flows_1 1 "E" 2 "U" 3 "N" 

. label values empstat_broad flows_1

. 
. 
. ** Create broad categories of labor status for the partners
. gen empstat_sp_broad = 0

. replace empstat_sp_broad = 1 if ( empstat_sp == 01 | empstat_sp == 10 | empstat_sp == 12 )
(6,091,441 real changes made)

. replace empstat_sp_broad = 2 if ( empstat_sp == 21 | empstat_sp == 22 )
(204,817 real changes made)

. replace empstat_sp_broad = 3 if ( labforce_sp == 1 )
(1,549,274 real changes made)

. 
. * Define the value labels
. label define flows_2 1 "E" 2 "U" 3 "N" 

. label values empstat_sp_broad flows_2

. 
. 
. ** Keep, Sort, order the data
. keep cpsid cpsidp year month empstat_sp_broad empstat_broad tran wtfinl

. sort year month empstat_sp_broad empstat_broad

. order cpsid cpsidp year month empstat_sp_broad empstat_broad tran wtfinl

. 
. 
. ** Compute the rates, employed partner
. 
. ** E-->E
. generate EE_ind = tran == 3 & empstat_sp_broad == 1

. by year month empstat_sp_broad empstat_broad: egen EE_mr = wtmean(100 * EE_ind), weight(wtfinl)

. 
. ** E-->U 
. generate EU_ind = tran == 2 & empstat_sp_broad == 1

. by year month empstat_sp_broad empstat_broad: egen EU_mr = wtmean(100 * EU_ind), weight(wtfinl)

. 
. ** E-->N
. generate EN_ind = tran == 5 & empstat_sp_broad == 1

. by year month empstat_sp_broad empstat_broad: egen EN_mr = wtmean(100 * EN_ind), weight(wtfinl)

. 
. ** U-->E
. generate UE_ind = tran == 1 & empstat_sp_broad == 1

. by year month empstat_sp_broad empstat_broad: egen UE_mr = wtmean(100 * UE_ind), weight(wtfinl)

. 
. ** U-->U
. generate UU_ind = tran == 8 & empstat_sp_broad == 1

. by year month empstat_sp_broad empstat_broad: egen UU_mr = wtmean(100 * UU_ind), weight(wtfinl)

. 
. ** U-->N
. generate UN_ind = tran == 6 & empstat_sp_broad == 1

. by year month empstat_sp_broad empstat_broad: egen UN_mr = wtmean(100 * UN_ind), weight(wtfinl)

. 
. ** N-->E
. generate NE_ind = tran == 4 & empstat_sp_broad == 1

. by year month empstat_sp_broad empstat_broad: egen NE_mr = wtmean(100 * NE_ind), weight(wtfinl)

. 
. ** N-->U
. generate NU_ind = tran == 7 & empstat_sp_broad == 1

. by year month empstat_sp_broad empstat_broad: egen NU_mr = wtmean(100 * NU_ind), weight(wtfinl)

. 
. ** N-->N
. generate NN_ind = tran == 9 & empstat_sp_broad == 1

. by year month empstat_sp_broad empstat_broad: egen NN_mr = wtmean(100 * NN_ind), weight(wtfinl)

. 
. drop UE_ind EU_ind EE_ind NE_ind EN_ind UN_ind NU_ind UU_ind NN_ind

. 
. foreach x of varlist EE_mr EU_mr EN_mr UE_mr UU_mr UN_mr NE_mr NU_mr NN_mr {   // rename all of the variables as the "spouse variable"
  2.         rename `x' `x'_E
  3. }

. *
. 
. 
. ** Compute the rates, unemployed partner
. 
. ** E-->E
. generate EE_ind = tran == 3 & empstat_sp_broad == 2

. by year month empstat_sp_broad empstat_broad: egen EE_mr = wtmean(100 * EE_ind), weight(wtfinl)

. 
. ** E-->U 
. generate EU_ind = tran == 2 & empstat_sp_broad == 2

. by year month empstat_sp_broad empstat_broad: egen EU_mr = wtmean(100 * EU_ind), weight(wtfinl)

. 
. ** E-->N
. generate EN_ind = tran == 5 & empstat_sp_broad == 2

. by year month empstat_sp_broad empstat_broad: egen EN_mr = wtmean(100 * EN_ind), weight(wtfinl)

. 
. ** U-->E
. generate UE_ind = tran == 1 & empstat_sp_broad == 2

. by year month empstat_sp_broad empstat_broad: egen UE_mr = wtmean(100 * UE_ind), weight(wtfinl)

. 
. ** U-->U
. generate UU_ind = tran == 8 & empstat_sp_broad == 2

. by year month empstat_sp_broad empstat_broad: egen UU_mr = wtmean(100 * UU_ind), weight(wtfinl)

. 
. ** U-->N
. generate UN_ind = tran == 6 & empstat_sp_broad == 2

. by year month empstat_sp_broad empstat_broad: egen UN_mr = wtmean(100 * UN_ind), weight(wtfinl)

. 
. ** N-->E
. generate NE_ind = tran == 4 & empstat_sp_broad == 2

. by year month empstat_sp_broad empstat_broad: egen NE_mr = wtmean(100 * NE_ind), weight(wtfinl)

. 
. ** N-->U
. generate NU_ind = tran == 7 & empstat_sp_broad == 2

. by year month empstat_sp_broad empstat_broad: egen NU_mr = wtmean(100 * NU_ind), weight(wtfinl)

. 
. ** N-->N
. generate NN_ind = tran == 9 & empstat_sp_broad == 2

. by year month empstat_sp_broad empstat_broad: egen NN_mr = wtmean(100 * NN_ind), weight(wtfinl)

. 
. drop UE_ind EU_ind EE_ind NE_ind EN_ind UN_ind NU_ind UU_ind NN_ind

. 
. foreach x of varlist EE_mr EU_mr EN_mr UE_mr UU_mr UN_mr NE_mr NU_mr NN_mr {   // rename all of the variables as the "spouse variable"
  2.         rename `x' `x'_U
  3. }

. *
. 
. 
. ** Compute the rates, nilf partner
. 
. ** E-->E
. generate EE_ind = tran == 3 & empstat_sp_broad == 3

. by year month empstat_sp_broad empstat_broad: egen EE_mr = wtmean(100 * EE_ind), weight(wtfinl)

. 
. ** E-->U 
. generate EU_ind = tran == 2 & empstat_sp_broad == 3

. by year month empstat_sp_broad empstat_broad: egen EU_mr = wtmean(100 * EU_ind), weight(wtfinl)

. 
. ** E-->N
. generate EN_ind = tran == 5 & empstat_sp_broad == 3

. by year month empstat_sp_broad empstat_broad: egen EN_mr = wtmean(100 * EN_ind), weight(wtfinl)

. 
. ** U-->E
. generate UE_ind = tran == 1 & empstat_sp_broad == 3

. by year month empstat_sp_broad empstat_broad: egen UE_mr = wtmean(100 * UE_ind), weight(wtfinl)

. 
. ** U-->U
. generate UU_ind = tran == 8 & empstat_sp_broad == 3

. by year month empstat_sp_broad empstat_broad: egen UU_mr = wtmean(100 * UU_ind), weight(wtfinl)

. 
. ** U-->N
. generate UN_ind = tran == 6 & empstat_sp_broad == 3

. by year month empstat_sp_broad empstat_broad: egen UN_mr = wtmean(100 * UN_ind), weight(wtfinl)

. 
. ** N-->E
. generate NE_ind = tran == 4 & empstat_sp_broad == 3

. by year month empstat_sp_broad empstat_broad: egen NE_mr = wtmean(100 * NE_ind), weight(wtfinl)

. 
. ** N-->U
. generate NU_ind = tran == 7 & empstat_sp_broad == 3

. by year month empstat_sp_broad empstat_broad: egen NU_mr = wtmean(100 * NU_ind), weight(wtfinl)

. 
. ** N-->N
. generate NN_ind = tran == 9 & empstat_sp_broad == 3

. by year month empstat_sp_broad empstat_broad: egen NN_mr = wtmean(100 * NN_ind), weight(wtfinl)

. 
. drop UE_ind EU_ind EE_ind NE_ind EN_ind UN_ind NU_ind UU_ind NN_ind

. 
. drop wtfinl

. 
. foreach x of varlist EE_mr EU_mr EN_mr UE_mr UU_mr UN_mr NE_mr NU_mr NN_mr {   // rename all of the variables as the "spouse variable"
  2.         rename `x' `x'_N
  3. }

. *
. 
. 
. ** Change from zero to missing
. 
. foreach x of varlist EE_mr_E EU_mr_E EN_mr_E UE_mr_E UU_mr_E UN_mr_E NE_mr_E NU_mr_E NN_mr_E EE_mr_U EU_mr_U EN_mr_U UE_mr_U UU_mr_U UN_mr_U NE_mr_U NU_mr_U NN_mr_U EE_mr_N EU_mr_N EN_mr_N UE_mr_N UU_mr_N UN_mr_N
>  NE_mr_N NU_mr_N NN_mr_N  {  
  2.         replace `x'=. if `x'==0 
  3. }
(3,078,609 real changes made, 3,078,609 to missing)
(3,078,609 real changes made, 3,078,609 to missing)
(3,078,609 real changes made, 3,078,609 to missing)
(7,685,250 real changes made, 7,685,250 to missing)
(7,685,250 real changes made, 7,685,250 to missing)
(7,685,250 real changes made, 7,685,250 to missing)
(6,681,296 real changes made, 6,681,296 to missing)
(6,681,296 real changes made, 6,681,296 to missing)
(6,681,296 real changes made, 6,681,296 to missing)
(7,700,102 real changes made, 7,700,102 to missing)
(7,700,406 real changes made, 7,700,406 to missing)
(7,700,102 real changes made, 7,700,102 to missing)
(7,827,243 real changes made, 7,827,243 to missing)
(7,827,243 real changes made, 7,827,243 to missing)
(7,827,261 real changes made, 7,827,261 to missing)
(7,804,552 real changes made, 7,804,552 to missing)
(7,804,434 real changes made, 7,804,434 to missing)
(7,804,434 real changes made, 7,804,434 to missing)
(6,774,074 real changes made, 6,774,074 to missing)
(6,774,074 real changes made, 6,774,074 to missing)
(6,774,074 real changes made, 6,774,074 to missing)
(7,804,342 real changes made, 7,804,342 to missing)
(7,804,342 real changes made, 7,804,342 to missing)
(7,804,342 real changes made, 7,804,342 to missing)
(7,408,906 real changes made, 7,408,906 to missing)
(7,408,906 real changes made, 7,408,906 to missing)
(7,408,906 real changes made, 7,408,906 to missing)

. *
. 
. 
. collapse EE_mr_E EU_mr_E EN_mr_E UE_mr_E UU_mr_E UN_mr_E NE_mr_E NU_mr_E NN_mr_E EE_mr_U EU_mr_U EN_mr_U UE_mr_U UU_mr_U UN_mr_U NE_mr_U NU_mr_U NN_mr_U EE_mr_N EU_mr_N EN_mr_N UE_mr_N UU_mr_N UN_mr_N NE_mr_N NU_
> mr_N NN_mr_N, by( year month empstat_sp_broad empstat_broad )

. 
. 
. *** Graphs
. 
. ** generate the time variable
. gen time=ym(year ,month), after(month)

. 
. 
. ** Change label
. 
. foreach x of varlist EE_mr_E EU_mr_E EN_mr_E UE_mr_E UU_mr_E UN_mr_E NE_mr_E NU_mr_E NN_mr_E  {  
  2.    label var `x' "Partner Employed" 
  3.    }

. 
. *
. 
. foreach x of varlist EE_mr_U EU_mr_U EN_mr_U UE_mr_U UU_mr_U UN_mr_U NE_mr_U NU_mr_U NN_mr_U  {  
  2.   label var `x' "Partner Unemployed" 
  3.    }

. 
. *
. 
. foreach x of varlist EE_mr_N EU_mr_N EN_mr_N UE_mr_N UU_mr_N UN_mr_N NE_mr_N NU_mr_N NN_mr_N  {  
  2.    label var `x' "Partner Not in the labor force" 
  3.    }

. 
. *
. 
. 
. ** Plots
. 
. graph drop _all

. 
. tw line EE_mr_E EE_mr_U EE_mr_N time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(EE) title("EE")

. graph export "$directory/Selection_07/EE.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_07/EE.png written in PNG format)

. 
. tw line EU_mr_E EU_mr_U EU_mr_N time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(EU) title("EU")

. graph export "$directory/Selection_07/EU.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_07/EU.png written in PNG format)

. 
. tw line EN_mr_E EN_mr_U EN_mr_N time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(EN) title("EN")

. graph export "$directory/Selection_07/EN.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_07/EN.png written in PNG format)

. 
. tw line UE_mr_E UE_mr_U UE_mr_N time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(UE) title("UE")

. graph export "$directory/Selection_07/UE.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_07/UE.png written in PNG format)

. 
. tw line UU_mr_E UU_mr_U UU_mr_N time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(UU) title("UU")

. graph export "$directory/Selection_07/UU.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_07/UU.png written in PNG format)

. 
. tw line UN_mr_E UN_mr_U UN_mr_N time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(UN) title("UN")

. graph export "$directory/Selection_07/UN.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_07/UN.png written in PNG format)

. 
. tw line NE_mr_E NE_mr_U NE_mr_N time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(NE) title("NE")

. graph export "$directory/Selection_07/NE.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_07/NE.png written in PNG format)

. 
. tw line NU_mr_E NU_mr_U NU_mr_N time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(NU) title("NU")

. graph export "$directory/Selection_07/NU.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_07/NU.png written in PNG format)

. 
. tw line NN_mr_E NN_mr_U NN_mr_N time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(NN) title("NN")

. graph export "$directory/Selection_07/NN.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_07/NN.png written in PNG format)

. 
. 
. 
. 
. ** Manipulates the final aggregate dataset
. drop time empstat_broad empstat_sp_broad

. collapse EE_mr_E EU_mr_E EN_mr_E UE_mr_E UU_mr_E UN_mr_E NE_mr_E NU_mr_E NN_mr_E EE_mr_U EU_mr_U EN_mr_U UE_mr_U UU_mr_U UN_mr_U NE_mr_U NU_mr_U NN_mr_U EE_mr_N EU_mr_N EN_mr_N UE_mr_N UU_mr_N UN_mr_N NE_mr_N NU_
> mr_N NN_mr_N, by ( year month )

. 
. 
. 
. ** Change label
. 
. foreach x of varlist EE_mr_E EU_mr_E EN_mr_E UE_mr_E UU_mr_E UN_mr_E NE_mr_E NU_mr_E NN_mr_E  {  
  2.    label var `x' "Partner Employed" 
  3.    }

. 
. *
. 
. foreach x of varlist EE_mr_U EU_mr_U EN_mr_U UE_mr_U UU_mr_U UN_mr_U NE_mr_U NU_mr_U NN_mr_U  {  
  2.   label var `x' "Partner Unemployed" 
  3.    }

. 
. *
. 
. foreach x of varlist EE_mr_N EU_mr_N EN_mr_N UE_mr_N UU_mr_N UN_mr_N NE_mr_N NU_mr_N NN_mr_N  {  
  2.    label var `x' "Partner Not in the labor force" 
  3.    }

. *
. 
. 
. 
. 
. 
. cd "$directory/Selection_07"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_07

. 
. save "Partn_status_flows.dta", replace
file Partn_status_flows.dta saved

. 
. 
. cd "$directory/Selection_05"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_05

. 
. log close main_06
      name:  main_06
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_05/main_06.log
  log type:  text
 closed on:  13 Jan 2018, 16:44:38
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
end of do-file

. timer off 6

. 
. timer on 7

. do main_07.do

. cls 

. 
. set more off

. 
. global directory = "/Users/tommaso/Desktop/RAship_Javier/IPUMS"

. 
. cd "$directory/Selection_05"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_05

. 
. capture: log close main_07

. log using "main_07", name("main_07") text replace 
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  main_07
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_05/main_07.log
  log type:  text
 opened on:  13 Jan 2018, 16:44:38

. 
. 
. use "Partners.dta", clear

. 
. ******************************************************************************************************************************
. **** This script computes the montly average unemployment duration, unconditional, and conditional on partner labor status.
. ******************************************************************************************************************************
. 
. 
. 
. ** Keep only unemployed workers
. keep if empstat == 21 | empstat ==22
(20,865,918 observations deleted)

. 
. 
. ** Keep variables I need
. keep cpsid cpsidp year month durunemp marst wtfinl empstat_sp labforce_sp

. order cpsid cpsidp year month marst durunemp empstat_sp labforce_sp wtfinl

. 
. ** Create broad categories of labor status for the partners
. gen empstat_sp_broad = ., before(empstat_sp)
(885,288 missing values generated)

. replace empstat_sp_broad = 1 if ( empstat_sp == 01 | empstat_sp == 10 | empstat_sp == 12 )
(223,599 real changes made)

. replace empstat_sp_broad = 2 if ( empstat_sp == 21 | empstat_sp == 22 )
(30,440 real changes made)

. replace empstat_sp_broad = 3 if ( labforce_sp == 1 )
(57,037 real changes made)

. 
. drop empstat_sp labforce_sp

. 
. ** Define the value labels
. label define flows_2 1 "E" 2 "U" 3 "N" 

. label values empstat_sp_broad flows_2

. 
. ** Sort the data 
. sort year month empstat_sp_broad

. 
. ** Compute the mean unconditional
. by year month : egen U_avg = wtmean(durunemp), weight(wtfinl) 

. 
. ** Compute the conditional
. by year month empstat_sp_broad : egen U_avg_cond_E = wtmean(durunemp) if empstat_sp_broad == 1, weight(wtfinl) 
(661689 missing values generated)

. 
. by year month empstat_sp_broad : egen U_avg_cond_U = wtmean(durunemp) if empstat_sp_broad == 2, weight(wtfinl) 
(854848 missing values generated)

. 
. by year month empstat_sp_broad : egen U_avg_cond_N = wtmean(durunemp) if empstat_sp_broad == 3, weight(wtfinl) 
(828251 missing values generated)

. 
. 
. drop wtfinl

. 
. ** Collapse
. collapse U_avg U_avg_cond_E U_avg_cond_U U_avg_cond_N, by (year month) 

. 
. 
. ** Lable variables
. label var U_avg "Continuous weeks unemployed. Monthly average"

. label var U_avg_cond_E "Partner employed"

. label var U_avg_cond_U "Partner unemployed"

. label var U_avg_cond_N "Partner Not in the labor force"

. 
. 
. 
. ** Plots
. 
. ** Generate the time variable
. gen time=ym(year ,month), after(month)

. 
. ** Plots
. graph drop _all

. 
. tw line U_avg time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(EE) title("Unemployment duration")

. graph export "$directory/Selection_08/Unemp_dur.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_08/Unemp_dur.png written in PNG format)

. 
. tw line U_avg_cond_E U_avg_cond_U U_avg_cond_N time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(EU) title("Unemp. duration, conditional on partner labor s
> tatus")

. graph export "$directory/Selection_08/Unemp_dur_cond.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_08/Unemp_dur_cond.png written in PNG format)

. 
. 
. ** Manipulate the dataset
. drop time

. 
. cd "$directory/Selection_08"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_08

. 
. save "Duration.dta", replace
file Duration.dta saved

. 
. 
. cd "$directory/Selection_05"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_05

. 
. log close main_07
      name:  main_07
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_05/main_07.log
  log type:  text
 closed on:  13 Jan 2018, 16:45:49
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

. 
. 
. 
. 
. 
. 
. 
. 
. 
. 
end of do-file

. timer off 7

. 
. timer on 8

. do main_08.do

. cls 

. 
. set more off

. 
. global directory = "/Users/tommaso/Desktop/RAship_Javier/IPUMS"

. 
. cd "$directory/Selection_05"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_05

. 
. capture: log close main_08

. log using "main_08", name("main_08") text replace 
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  main_08
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_05/main_08.log
  log type:  text
 opened on:  13 Jan 2018, 16:45:49

. 
. 
. 
. ******************************************************************************************************************************
. *** Selection of sample for the wage study.
. ******************************************************************************************************************************
. 
. 
. 
. ******************************************************************************************************************************
. *** For the analysis of the wage correlation I need both partners'wages, while for the regression I just need the partners' wages.
. ******************************************************************************************************************************
. 
. 
. use "Partners.dta", clear

. 
. 
. ** Keep only the variable I need for this computation (maybe change later but now stay with it)
. 
. drop  cpsidp_sp eligorg eligorg_sp relate 

. 
. 
. ** Keep only the married couples who live together
. keep if marst==1
(9,366,218 observations deleted)

. drop marst

. 
. ** Keep only Outgoing Rotation Group 
. keep if mish == 4 | mish == 8 
(9,272,892 observations deleted)

. 
. ** Armed forces don't report wages, drop them
. drop if empstat == 01
(23,009 observations deleted)

. * Drop if the partner is in the army
. drop if empstat_sp == 01
(22,122 observations deleted)

. 
. 
. * Drop if there are no information about the partner; use age as proxy
. drop if age_sp == . 
(153,961 observations deleted)

. 
. 
. * I get rid of that 13% of employed workers partners whose wage is not reported: paidhour == 0 implies that wages are not reported, both for hour and weekly wage
. * This is to be done both for computing correlation and for regression, therefore i do it here.
. drop if paidhour_sp == 0 & (empstat_sp == 10 | empstat_sp == 12)  // 13% of the sample until here.
(311,174 observations deleted)

. 
. 
. 
. /* Now the employed partners are divided perfectly in those paid by hour 
> and those not paid by hour */
. 
. * Nicest order so far, generalize
. order cpsid cpsidp year month mish age sex race race_broad child_18 hhtenure hwtfinl statefip empstat labforce jtyears durunemp durunemp_pre tran tran1 rearnweek rhourwage earnweek hourwage uhrsworkorg paidhour o
> tpay lfproxy earnwt ind1950 ind1950_broad ind1950_broad_pre occ1950 occ1950_broad occ1950_broad_pre switch switch1 agr_pa educ classwkr wtfinl mish_sp age_sp sex_sp race_sp race_broad_sp child_18_sp hhtenure_sp s
> tatefip_sp empstat_sp labforce_sp jtyears_sp durunemp_sp durunemp_pre_sp tran_sp tran1_sp rearnweek_sp rhourwage_sp earnweek_sp hourwage_sp uhrsworkorg_sp paidhour_sp otpay_sp lfproxy_sp earnwt_sp ind1950_sp ind1
> 950_broad_sp ind1950_broad_pre_sp occ1950_sp occ1950_broad_sp occ1950_broad_pre_sp switch_sp switch1_sp agr_pa_sp educ_sp classwkr_sp wtfinl_sp

. 
. 
. ***************************************************************
. save "ORG_couples.dta", replace
file ORG_couples.dta saved

. * use "ORG_couples.dta", clear
. ***************************************************************
. 
. 
. 
. 
. 
. **** DESCRIPTIVE STATISTICS 
. 
. ***Hourwage
. 
. ** There are not topcoded hourwages
. 
. ** Dummy for not in the universe hourwage
. gen dummy = 0

. replace dummy = 1 if hourwage_sp == 99.99
(1,574,711 real changes made)

. label var dummy "NIU hourwage"

. label define lab_0 0 "No" 1 "Yes" 

. label values dummy lab_0

. 
. tab dummy if paidhour_sp == 1

        NIU |
   hourwage |      Freq.     Percent        Cum.
------------+-----------------------------------
        Yes |    921,359      100.00      100.00
------------+-----------------------------------
      Total |    921,359      100.00

. tab dummy if paidhour_sp == 2

        NIU |
   hourwage |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |  1,027,119       99.99       99.99
        Yes |        132        0.01      100.00
------------+-----------------------------------
      Total |  1,027,251      100.00

. 
. 
. /* Hourwage is reported for 99.99% of workers paid by hour. Ideally, to have 
> to use this variable would be better. It is more informative indeed. */
. 
. 
. 
. 
. 
. *** Earnweek
. 
. ** Dummy for not in the universe earnweek
. gen dummy3 = 0

. replace dummy3 = 1 if earnweek_sp == 9999.99
(653,225 real changes made)

. label var dummy3 "NIU earnweek"

. label define lab_3 0 "No" 1 "Yes" 

. label values dummy3 lab_3

. 
. 
. drop if dummy3 == 1 &  (empstat_sp == 10 | empstat_sp == 12 ) // 5 observations
(5 observations deleted)

. 
. 
. tab dummy3 if empstat_sp == 10 | empstat_sp == 12 // in the sample so created, everybody reports the earnweek.

        NIU |
   earnweek |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |  1,948,605      100.00      100.00
------------+-----------------------------------
      Total |  1,948,605      100.00

. 
. 
. ***************************************************************
. * What follows does not have consequences on next operations, analysis of the characteristics of some wage variables.
. ***************************************************************
. 
. /*
> 
> ** Dummy for top code earnweek
> gen dummy4 = 0
> replace dummy4 = 1 if earnweek == 1923 & ( year == 1990 | year == 1991 |year == 1992 |year == 1993 |year == 1994 |year == 1995 |year == 1996 |year == 1997 ) 
> gen dummy5 = 0
> replace dummy5 = 1 if earnweek == 2884.61 & year > 1990 
> gen dummy6 = 0 
> replace dummy6 = 1 if dummy4 ==1 | dummy5 ==1 // 1% top coded earnweek
> 
> 
> *** Uhrsworkorg
> 
> ** Dummy for NIU
> gen dummy7 = 0
> replace dummy7 = 1 if uhrsworkorg == 0 // zero 
> 
> ** Dummy for don't know
> gen dummy8 = 0 
> replace dummy8 = 1 if uhrsworkorg == 998 //
> 
> ** Dummy for don't know (999)
> gen dummy9 = 0 
> replace dummy9 = 1 if uhrsworkorg == 999 // 
> label var dummy9 "NIU uhrsworkorg"
> label define lab_9 0 "No" 1 "Yes" 
> label values dummy9 lab_9
> 
> tab dummy8 if empstat == 10 | empstat == 12
> tab dummy9 if empstat == 10 | empstat == 12 // 60.7% of the employed don't know how many hour they work.
> 
> 
> 
> * After this trimming, the percentages are:
> tab paidhour if empstat == 10 | empstat == 12 // 40% no, 60% yes.
> 
> tab dummy9 if empstat == 10 | empstat == 12 // 60%  dont report the hoursworked. 
> tab dummy9 if (empstat == 10 | empstat == 12) & paidhour == 2 // Of those paid by hour, 25% don't know how many hours they work.
> tab dummy9 if (empstat == 10 | empstat == 12) & paidhour == 1 // Of those not paid by hour, 100% don't know how many hours they work.
> tab dummy if (empstat == 10 | empstat == 12) & paidhour == 2 // Of those paid by hour, 99.99% report their hour wage rate.
> 
> tab dummy if (empstat == 10 | empstat == 12) & paidhour == 2 // Of those paid by hour, 99.99% report their hour wage rate.
> 
> tab dummy3 if empstat == 10 | empstat == 12 & paidhour == 1 // Of those not paid by hour 100% report their wage.
> 
> drop dummy dummy2 dummy3 dummy4 dummy5 dummy6 dummy7 dummy8 dummy9
> 
> */
. 
. 
. 
. 
. 
. ** Assign a zero wage to those who are unemployed or NILF
. replace rhourwage = 0 if empstat != 10 & empstat != 12
(596,783 real changes made)

. replace rhourwage_sp = 0 if empstat_sp != 10 & empstat_sp != 12
(653,220 real changes made)

. 
. replace rearnweek = 0 if empstat != 10 & empstat != 12
(596,783 real changes made)

. replace rearnweek_sp = 0 if empstat_sp != 10 & empstat_sp != 12
(653,220 real changes made)

. 
. 
. 
. 
. cd "$directory/Selection_09"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_09

. 
. save "Earner_study.dta", replace
file Earner_study.dta saved

. 
. 
. cd "$directory/Selection_05"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_05

. 
. log close main_08
      name:  main_08
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_05/main_08.log
  log type:  text
 closed on:  13 Jan 2018, 16:48:16
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

. 
. 
. 
end of do-file

. timer off 8

. 
. 
. cd "$directory/Selection_09"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_09

. timer on 9

. do main_09_w_corr.do

. cls 

. 
. set more off

. 
. global directory = "/Users/tommaso/Desktop/RAship_Javier/IPUMS"

. 
. cd "$directory/Selection_09"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_09

. 
. capture: log close main_09_w_corr

. log using "main_09_w_corr", name("main_09_w_corr") text replace 
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  main_09_w_corr
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_09/main_09_w_corr.log
  log type:  text
 opened on:  13 Jan 2018, 16:48:16

. 
. 
. 
. use "Earner_study.dta", clear

. 
. 
. ******************************************************************************************************************************
. *** Weekly wage, couple study, correlation
. ******************************************************************************************************************************
. 
. 
. 
. ******************************************************************************************************************************
. *** Initial operations: 
. ******************************************************************************************************************************
. 
. 
. drop rhourwage hourwage rhourwage_sp hourwage_sp

. 
. * For the correlation, I care also about the wage of the reference guy, then I drop the employed who don't repot wage.
. drop if paidhour == 0 & (empstat == 10 | empstat == 12)  
(215,310 observations deleted)

. 
. * Drop employed with zero wage
. drop if earnweek == 0 & ( empstat == 10 | empstat == 12 )
(3,098 observations deleted)

. drop if earnweek_sp == 0 & ( empstat_sp == 10 | empstat_sp == 12 )
(2,714 observations deleted)

. 
. 
. * Trim implausible weekly wage:
. drop if rearnweek > 2000 
(3 observations deleted)

. drop if rearnweek > 0 & rearnweek < 50  
(24,956 observations deleted)

. drop if rearnweek_sp>2000 
(0 observations deleted)

. drop if rearnweek_sp>0 & rearnweek_sp< 50 
(24,240 observations deleted)

. 
. 
. 
. 
. ** Use log wages
. gen log_wage = ln(rearnweek + 1), after(rearnweek)

. 
. gen log_wage_sp= ln(rearnweek_sp + 1), after(rearnweek_sp)

. 
. 
. 
. 
. ******************************************************************************************************************************
. *** Compute/graph the yearly avg. correlation of earnings of the couple -conditional on both working, and unconditional too.
. ******************************************************************************************************************************
. 
. sort year month         

. 
. *** General
. 
. ** Assign a number to each month 
. egen group = group(year month)

. order group, after(month)

. 
. 
. **  Unconditional 
. su group, meanonly

. gen cor_unc = .
(2,331,504 missing values generated)

. qui forvalues i = 1/`r(max)' {

. *
. 
. **  Conditional 
. su group, meanonly

. gen cor_con = .
(2,331,504 missing values generated)

. qui forvalues i = 1/`r(max)' {

. *
. 
. 
. **** Earnings correlation for age cluster
. 
. *** 18 --> 35
. 
. **  Unconditional 
. su group, meanonly

. gen cor_unc_18 = .
(2,331,504 missing values generated)

. qui forvalues i = 1/`r(max)' {

. *
. 
. **  Conditional 
. su group, meanonly

. gen cor_con_18 = .
(2,331,504 missing values generated)

. qui forvalues i = 1/`r(max)' {

. *
. 
. 
. *** 35 --> 55
. 
. **  Unconditional 
. su group, meanonly

. gen cor_unc_35 = .
(2,331,504 missing values generated)

. qui forvalues i = 1/`r(max)' {

. *
. 
. **  Conditional 
. su group, meanonly

. gen cor_con_35 = .
(2,331,504 missing values generated)

. qui forvalues i = 1/`r(max)' {

. *
. 
. 
. 
. *** 55 --> 65
. 
. **  Unconditional 
. su group, meanonly

. gen cor_unc_55 = .
(2,331,504 missing values generated)

. qui forvalues i = 1/`r(max)' {

. *
. 
. **  Conditional 
. su group, meanonly

. gen cor_con_55 = .
(2,331,504 missing values generated)

. qui forvalues i = 1/`r(max)' {

. *
. 
. 
. 
. 
. ** Collapse. ( Notice: it's important to graph after collapsing, otherwise it takes a while. )
. 
. collapse cor_unc cor_con cor_unc_18 cor_con_18 cor_unc_35 cor_con_35 cor_unc_55 cor_con_55, by ( year month )

. 
. ** Label
. label var cor_unc "Wages correlation"

. label var cor_con "Wages correlation"

. label var cor_unc_18 "Wages correlation"

. label var cor_con_18 "Wages correlation"

. label var cor_unc_35 "Wages correlation"

. label var cor_con_35 "Wages correlation"

. label var cor_unc_55 "Wages correlation"

. label var cor_con_55 "Wages correlation"

. 
. 
. ** Generate the time variable
. gen time=ym(year ,month), after(month)

. 
. *** Plots
. graph drop _all

. 
. ** Correlations
. 
. ** general
. tw line cor_unc time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(Corr_unc) title("Earnings correlation, uncoditional")

. graph export "$directory/Selection_10/Correlation/corr_unc.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Correlation/corr_unc.png written in PNG format)

. 
. tw line cor_con time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(Corr_con) title("Earnings correlation, conditional on both working")

. graph export "$directory/Selection_10/Correlation/corr_con.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Correlation/corr_con.png written in PNG format)

. 
. ** 18-->35
. tw line cor_unc_18 time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(Corr_unc_18) title("Earnings correlation, uncoditional, 18-35")

. graph export "$directory/Selection_10/Correlation/corr_unc_18.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Correlation/corr_unc_18.png written in PNG format)

. 
. tw line cor_con_18 time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(Corr_con_18) title("Earnings correlation, conditional on both working, 18-35")

. graph export "$directory/Selection_10/Correlation/corr_con_18.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Correlation/corr_con_18.png written in PNG format)

. 
. 
. ** 35-->65
. tw line cor_unc_35 time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(Corr_unc_35) title("Earnings correlation, uncoditional, 35-55")

. graph export "$directory/Selection_10/Correlation/corr_unc_35.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Correlation/corr_unc_35.png written in PNG format)

. 
. tw line cor_con_35 time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(Corr_con_35) title("Earnings correlation, conditional on both working, 35-55")

. graph export "$directory/Selection_10/Correlation/corr_con_35.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Correlation/corr_con_35.png written in PNG format)

. 
. 
. ** 55-->65
. tw line cor_unc_55 time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(Corr_unc_55) title("Earnings correlation, uncoditional, 55-65")

. graph export "$directory/Selection_10/Correlation/corr_unc_55.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Correlation/corr_unc_55.png written in PNG format)

. 
. tw line cor_con_55 time , xtick(407.5(12)695.5, tlength(*1.5)) xlabel(425.5(24)689.5, noticks format(%tmYY))  xtitle("") name(Corr_con_55) title("Earnings correlation, conditional on both working, 55-65")

. graph export "$directory/Selection_10/Correlation/corr_con_55.png" , replace
(file /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Correlation/corr_con_55.png written in PNG format)

. 
. 
. cd "$directory/Selection_10/Correlation"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Correlation

. save "Corr.dta", replace
file Corr.dta saved

. 
. 
. cd "$directory/Selection_09"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_09

. log close main_09_w_corr
      name:  main_09_w_corr
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_09/main_09_w_corr.log
  log type:  text
 closed on:  13 Jan 2018, 16:58:04
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

. 
. 
. 
end of do-file

. timer off 9

. 
. timer on 10

. do main_09_w_regr.do

. cls 

. 
. set more off

. 
. global directory = "/Users/tommaso/Desktop/RAship_Javier/IPUMS"

. 
. cd "$directory/Selection_09"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_09

. 
. capture: log close main_09_w_regr

. log using "main_09_w_regr", name("main_09_w_regr") text replace 
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  main_09_w_regr
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_09/main_09_w_regr.log
  log type:  text
 opened on:  13 Jan 2018, 16:58:04

. 
. 
. 
. use "Earner_study.dta", clear

. 
. 
. ******************************************************************************************************************************
. *** Weekly wage, couple study; probit regression, cox hazard estimation
. ******************************************************************************************************************************
. 
. 
. 
. ******************************************************************************************************************************
. *** Initial operations: 
. ******************************************************************************************************************************
. 
. * Keep only hourly wage
. drop rhourwage hourwage rhourwage_sp hourwage_sp

. 
. * Drop reference's wage, I just the partner's wage
. drop earnweek rearnweek

. 
. * Drop employed with zero wage; for the regression analysis, I care only about partner's wage.
. drop if earnweek_sp == 0 & ( empstat_sp == 10 | empstat_sp == 12 )
(4,068 observations deleted)

. 
. 
. * Of those employed and paid by hour, somebody doesn't report the wage (132)
. drop if earnweek_sp == 99.99  & ( empstat_sp == 10 | empstat_sp == 12 ) 
(1 observation deleted)

. 
. 
. * Trim implausible weekly wage:
. drop if rearnweek_sp>2000 
(0 observations deleted)

. drop if rearnweek_sp>0 & rearnweek_sp<50   
(28,776 observations deleted)

. 
. 
. 
. 
. ** Use log wages
. gen log_wage_sp= ln(rearnweek_sp + 1), after(rearnweek_sp)

. 
. 
. ****************************************************************************************************************************** 
. *** PROBIT REGRESSIONS
. ******************************************************************************************************************************
. 
. 
. sort cpsidp year month

. 
. 
. *** Generate the variables
. 
. ** Transit from Unemp. to Emp. (UE)
. gen tran_org = ., after(tran1)
(2,568,980 missing values generated)

. replace tran_org = 0 if ( tran == 1 | tran == 6 | tran == 8 ) // Unemployed at previous period
(66,374 real changes made)

. replace tran_org = 1 if tran == 1 // Employed in "Current"
(16,394 real changes made)

. label var tran_org "U-->E"

. 
. 
. 
. ** Create quintiles
. egen q_wage_sp = xtile(log_wage_sp) if empstat_sp == 10 | empstat_sp == 12, w(earnwt) n(5)
(653220 missing values generated)

. order q_wage_sp, after(log_wage_sp)

. 
. 
. 
. ** Generate dummies for the 6 categories I need:
. 
. * UN
. gen UN_ind_sp = 0, after(q_wage_sp)

. replace UN_ind_sp = 1 if empstat_sp != 10 & empstat_sp != 12
(653,220 real changes made)

. * Q1
. gen q1_ind_sp = 0, after(UN_ind_sp)

. replace q1_ind_sp = 1 if q_wage_sp == 1
(375,517 real changes made)

. * Q2
. gen q2_ind_sp = 0, after(q1_ind_sp)

. replace q2_ind_sp = 1 if q_wage_sp == 2
(385,783 real changes made)

. * Q3
. gen q3_ind_sp = 0, after(q2_ind_sp)

. replace q3_ind_sp = 1 if q_wage_sp == 3
(389,198 real changes made)

. * Q4
. gen q4_ind_sp = 0, after(q3_ind_sp)

. replace q4_ind_sp = 1 if q_wage_sp == 4
(388,702 real changes made)

. * Q5
. gen q5_ind_sp = 0, after(q4_ind_sp)

. replace q5_ind_sp = 1 if q_wage_sp == 5
(376,560 real changes made)

. 
. 
. ** Get the unemployemnt rate from Dataset_3.dta, then take the log:
. cd "$directory/Selection_04"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_04

. merge m:1 year month using "Dataset_4.dta"
(label month_lbl already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                        20,535
        from master                    20,535  (_merge==1)
        from using                          0  (_merge==2)

    matched                         2,548,445  (_merge==3)
    -----------------------------------------

. drop EE_mr EU_mr EN_mr UE_mr UU_mr UN_mr NE_mr NU_mr NN_mr EE_mr_f EU_mr_f EN_mr_f UE_mr_f UU_mr_f UN_mr_f NE_mr_f NU_mr_f NN_mr_f EE_mr_m EU_mr_m EN_mr_m UE_mr_m UU_mr_m UN_mr_m NE_mr_m NU_mr_m NN_mr_m

. drop _merge

. 
. gen log_unEmp = log(UnEmp_rate + 1)
(20,535 missing values generated)

. 
. 
. ** generate the time variable
. gen time=ym(year ,month), after(month)

. 
. ** Polynomial of age
. gen age2 = age^2

. 
. 
. 
. 
. *** UE Probit regression; omit one dummy to avoid collinearity; 
. set matsize 700

. 
. qui probit tran_org age age2  time durunemp_pre UnEmp_rate  child_18 race_broad UN_ind_sp q1_ind_sp q2_ind_sp q3_ind_sp q4_ind_sp q5_ind_sp i.time i.educ_broad i.occ1950_broad_pre i.ind1950_broad_pre i.hhtenure i
> .statefip [pweight = earnwt] 

. estimates table, drop(i.time i.occ1950_broad_pre i.ind1950_broad_pre i.hhtenure i.statefip) star // this is manly done to suppres all the coefficient on i.time etc. (see h estimates table for details)

------------------------------
    Variable |    active      
-------------+----------------
         age | -.00463369     
        age2 | -3.757e-06     
        time | -.00198644     
durunemp_pre | -.01016419***  
  UnEmp_rate | -35.229906     
    child_18 |  .03611081*    
  race_broad | -.08364824***  
   UN_ind_sp |  .01914092     
   q1_ind_sp |  .01864185     
   q2_ind_sp | -.01360183     
   q3_ind_sp |  .03162346     
   q4_ind_sp | -.00294326     
   q5_ind_sp |  (omitted)     
             |
  educ_broad |
Highschoo..  |  .00053814     
Some coll..  |  .02577781     
Associate..  |  .04097708     
More than..  |  .07766526*    
             |
       _cons |  2.2442529     
------------------------------
legend: * p<0.05; ** p<0.01; *** p<0.001

. 
. cd "$directory/Selection_10/Table"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Table

. outreg2 age age2 log_unEmp time durunemp_pre child_18 race_broad UN_ind_sp q1_ind_sp q2_ind_sp q3_ind_sp q4_ind_sp q5_ind_sp using prob1_1_w.doc, replace tex ctitle(UE Probit) drop(i.time i.occ1950_broad_pre i.in
> d1950_broad_pre i.hhtenure i.statefip)
prob1_1_w.tex
prob1_1_w.doc
dir : seeout

. cd "$directory/Selection_09"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_09

. 
. 
. 
. 
. 
. ******** Job switching Probit regression; omit one dummy to avoid collinearity; 
. 
. qui probit switch age age2 log_unEmp time durunemp_pre  child_18 race_broad UN_ind_sp q1_ind_sp q2_ind_sp q3_ind_sp q4_ind_sp q5_ind_sp i.time i.educ_broad i.occ1950_broad_pre i.ind1950_broad_pre i.hhtenure i.sta
> tefip [pweight = earnwt] if tran_org == 1

. estimates table, drop(i.time i.occ1950_broad_pre i.ind1950_broad_pre i.hhtenure i.statefip) star // this is manly done to suppres all the coefficient on i.time etc. (see h estimates table" for details)

------------------------------
    Variable |    active      
-------------+----------------
         age | -.03358221***  
        age2 |  .00026824**   
   log_unEmp | -44.150502     
        time | -.00403629     
durunemp_pre |  .00722075***  
    child_18 | -.03588293     
  race_broad |  .03602737     
   UN_ind_sp |  .12569117**   
   q1_ind_sp |  .14408824**   
   q2_ind_sp |  .13049176**   
   q3_ind_sp |  .16322825***  
   q4_ind_sp |  .10570938*    
   q5_ind_sp |  (omitted)     
             |
  educ_broad |
Highschoo..  |  .06685573     
Some coll..  |  .14152955**   
Associate..  |  .11286063**   
More than..  |  .03099726     
             |
       _cons |   5.986714     
------------------------------
legend: * p<0.05; ** p<0.01; *** p<0.001

. 
. cd "$directory/Selection_10/Table"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Table

. outreg2 age age2 log_unEmp time durunemp_pre child_18 race_broad UN_ind_sp q1_ind_sp q2_ind_sp q3_ind_sp q4_ind_sp q5_ind_sp using prob1_2_w.doc, replace tex ctitle(Occ switch) drop(i.time i.educ i.occ1950_broad_
> pre i.ind1950_broad_pre i.hhtenure i.statefip)
prob1_2_w.tex
prob1_2_w.doc
dir : seeout

. cd "$directory/Selection_09"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_09

. 
. 
. 
. 
. ****************************************************************************************************************************** 
. *** COX REGRESSION
. ******************************************************************************************************************************
. 
. ******** UE Cox, hazard model
. 
. drop if tran_org == . 
(2,502,606 observations deleted)

. 
. stset durunemp_pre [pweight = earnwt] , failure(tran_org == 1)

     failure event:  tran_org == 1
obs. time interval:  (0, durunemp_pre]
 exit on or before:  failure
            weight:  [pweight=earnwt]

------------------------------------------------------------------------------
      66374  total observations
        151  observations end on or before enter()
------------------------------------------------------------------------------
      66223  observations remaining, representing
      16332  failures in single-record/single-failure data
    1562998  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       119

. 
. qui stcox age age2 log_unEmp time child_18 race_broad UN_ind_sp q1_ind_sp q2_ind_sp q3_ind_sp q4_ind_sp q5_ind_sp i.time i.educ_broad i.occ1950_broad_pre i.ind1950_broad_pre i.hhtenure i.statefip, nohr 

. estimates table, drop(i.time i.occ1950_broad_pre i.ind1950_broad_pre i.hhtenure i.statefip) star // this is manly done to suppres all the coefficient on i.time etc. (see h estimates table" for details)

------------------------------
    Variable |    active      
-------------+----------------
         age |  -.0318967***  
        age2 |  .00016886*    
   log_unEmp |          0     
        time |  .00030315     
    child_18 |  .07991162***  
  race_broad | -.25802072***  
   UN_ind_sp | -.04888281     
   q1_ind_sp | -.05680012     
   q2_ind_sp | -.08652483*    
   q3_ind_sp |   .0036462     
   q4_ind_sp | -.01623131     
   q5_ind_sp |  (omitted)     
             |
  educ_broad |
Highschoo..  |  .02335864     
Some coll..  |  .06472841*    
Associate..  |  .10580049**   
More than..  |  .13268414**   
------------------------------
legend: * p<0.05; ** p<0.01; *** p<0.001

. 
. cd "$directory/Selection_10/Table"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Table

. outreg2 age age2 log_unEmp time child_18 race_broad UN_ind_sp q1_ind_sp q2_ind_sp q3_ind_sp q4_ind_sp q5_ind_sp using probH_1_w.doc, replace tex ctitle(Hazard UE) drop(i.time i.educ i.occ1950_broad_pre i.ind1950_
> broad_pre i.hhtenure i.statefip)
probH_1_w.tex
probH_1_w.doc
dir : seeout

. cd "$directory/Selection_09"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_09

. 
. 
. 
. ******** Job switch, Cox hazard model
. 
. stset durunemp_pre [pweight = earnwt] , failure(switch == 1)

     failure event:  switch == 1
obs. time interval:  (0, durunemp_pre]
 exit on or before:  failure
            weight:  [pweight=earnwt]

------------------------------------------------------------------------------
      66374  total observations
        151  observations end on or before enter()
------------------------------------------------------------------------------
      66223  observations remaining, representing
      11111  failures in single-record/single-failure data
    1562998  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       119

. 
. qui stcox age age2 log_unEmp time child_18 race_broad UN_ind_sp q1_ind_sp q2_ind_sp q3_ind_sp q4_ind_sp q5_ind_sp i.time i.educ_broad i.occ1950_broad_pre i.ind1950_broad_pre i.hhtenure i.statefip if tran_org == 1
> , nohr 

. estimates table, drop(i.time i.occ1950_broad_pre i.ind1950_broad_pre i.hhtenure i.statefip) star // this is manly done to suppres all the coefficient on i.time etc. (see h estimates table" for details)

------------------------------
    Variable |    active      
-------------+----------------
         age | -.04792806***  
        age2 |  .00039246***  
   log_unEmp | -72.305353     
        time | -.00579856     
    child_18 | -.00243414     
  race_broad | -.13061001***  
   UN_ind_sp | -.05906732     
   q1_ind_sp | -.04593353     
   q2_ind_sp |  -.0519139     
   q3_ind_sp |  .01924401     
   q4_ind_sp |  .04115565     
   q5_ind_sp |  (omitted)     
             |
  educ_broad |
Highschoo..  |  .03989966     
Some coll..  |  .10467767*    
Associate..  |  .10938183*    
More than..  |  .04421358     
------------------------------
legend: * p<0.05; ** p<0.01; *** p<0.001

. 
. cd "$directory/Selection_10/Table"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Table

. outreg2 age age2 log_unEmp time child_18 race_broad UN_ind_sp q1_ind_sp q2_ind_sp q3_ind_sp q4_ind_sp q5_ind_sp using probH_2_w.doc, replace tex ctitle(Hazard Occ Switch) drop(i.time i.educ i.occ1950_broad_pre i.
> ind1950_broad_pre i.hhtenure i.statefip)
probH_2_w.tex
probH_2_w.doc
dir : seeout

. cd "$directory/Selection_09"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_09

. 
. 
. log close main_09_w_regr
      name:  main_09_w_regr
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_09/main_09_w_regr.log
  log type:  text
 closed on:  13 Jan 2018, 17:24:16
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

. 
. 
. 
end of do-file

. timer off 10

. 
. 
. cd "$directory/Aggregate"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Aggregate

. timer on 11

. do aggr_script.do

. cls 

. 
. set more off

. 
. global directory = "/Users/tommaso/Desktop/RAship_Javier/IPUMS"

. 
. cd "$directory/Aggregate"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Aggregate

. 
. capture: log close main_aggr

. log using "main_aggr", name("main_aggr") text replace 
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  main_aggr
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Aggregate/main_aggr.log
  log type:  text
 opened on:  13 Jan 2018, 17:24:16

. 
. 
. timer on 1

. 
. *** This script merges together the aggregate datasets
. 
. cd "$directory/Selection_04"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_04

. use "dataset_4.dta", clear

. 
. cd "$directory/Selection_07"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_07

. merge 1:1 year month using "Partn_status_flows.dta" 
(label month_lbl already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               275  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. cd "$directory/Selection_08"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_08

. merge 1:1 year month using "Duration.dta"
(label month_lbl already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                             2
        from master                         0  (_merge==1)
        from using                          2  (_merge==2)

    matched                               275  (_merge==3)
    -----------------------------------------

. drop _merge

. sort year month

. 
. cd "$directory/Selection_06"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_06

. merge 1:1 year month using "Cond_tran.dta"
(label month_lbl already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               277  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. cd "$directory/Selection_10/Correlation"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Selection_10/Correlation

. merge 1:1 year month using "Corr.dta"
(label month_lbl already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               277  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. 
. order time, after(month)

. 
. 
. ** Light modification for clarity
. 
. foreach x of varlist EE_mr EU_mr EN_mr UE_mr UU_mr UN_mr NE_mr NU_mr NN_mr  {  
  2.    label var `x' "General transition rates" 
  3.    }

. 
. *
. 
. 
. foreach x of varlist EE_mr_f EU_mr_f EN_mr_f UE_mr_f UU_mr_f UN_mr_f NE_mr_f NU_mr_f NN_mr_f  {  
  2.    label var `x' "Gen. tran. rates, females" 
  3.    }

. 
. *
. 
. foreach x of varlist EE_mr_m EU_mr_m EN_mr_m UE_mr_m UU_mr_m UN_mr_m NE_mr_m NU_mr_m NN_mr_m  {  
  2.    label var `x' "Gen. tran. rates, males" 
  3.    }

. 
. *
. 
. 
. cd "$directory/Aggregate"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Aggregate

. 
. save "Aggregate.dta", replace
file Aggregate.dta saved

. 
. log close main_aggr
      name:  main_aggr
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Aggregate/main_aggr.log
  log type:  text
 closed on:  13 Jan 2018, 17:24:16
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

. 
. 
. 
. timer off 1 

. timer list 1
   1:    847.25 /        4 =     211.8117

. 
end of do-file

. timer off 11

. 
. 
. timer off 12

. 
. 
. timer list 1
   1:    847.25 /        4 =     211.8117

. timer list 2
   2:    235.26 /        2 =     117.6325

. timer list 3
   3:    370.25 /        1 =     370.2480

. timer list 4
   4:    746.04 /        1 =     746.0390

. timer list 5
   5:    139.56 /        1 =     139.5570

. timer list 6
   6:    269.54 /        1 =     269.5390

. timer list 7
   7:     71.13 /        1 =      71.1310

. timer list 8
   8:    146.74 /        1 =     146.7400

. timer list 9
   9:    588.03 /        1 =     588.0310

. timer list 10
  10:   1572.15 /        1 =    1572.1460

. timer list 11
  11:      0.06 /        1 =       0.0600

. timer list 12
  12:   4742.38 /        1 =    4742.3780

. 
. 
. 
. 
. 
. 
. 
. cd "$directory/Structure"
/Users/tommaso/Desktop/RAship_Javier/IPUMS/Structure

. log close log_structure
      name:  log_structure
       log:  /Users/tommaso/Desktop/RAship_Javier/IPUMS/Structure/log_structure.log
  log type:  text
 closed on:  13 Jan 2018, 17:24:16
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
